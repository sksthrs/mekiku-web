(()=>{"use strict";var t={572:(t,e,i)=>{i.r(e),i.d(e,{default:()=>f});var n="undefined"!=typeof window?window:null,o=null===n,s=o?void 0:n.document,a="horizontal",r=function(){return!1},l=o?"calc":["","-webkit-","-moz-","-o-"].filter((function(t){var e=s.createElement("div");return e.style.cssText="width:"+t+"calc(9px)",!!e.style.length})).shift()+"calc",h=function(t){return"string"==typeof t||t instanceof String},d=function(t){if(h(t)){var e=s.querySelector(t);if(!e)throw new Error("Selector "+t+" did not match a DOM element");return e}return t},u=function(t,e,i){var n=t[e];return void 0!==n?n:i},c=function(t,e,i,n){if(e){if("end"===n)return 0;if("center"===n)return t/2}else if(i){if("start"===n)return 0;if("center"===n)return t/2}return t},p=function(t,e){var i=s.createElement("div");return i.className="gutter gutter-"+e,i},g=function(t,e,i){var n={};return h(e)?n[t]=e:n[t]=l+"("+e+"% - "+i+"px)",n},m=function(t,e){var i;return(i={})[t]=e+"px",i};const f=function(t,e){if(void 0===e&&(e={}),o)return{};var i,l,h,f,y,C,_=t;Array.from&&(_=Array.from(_));var v=d(_[0]).parentNode,S=getComputedStyle?getComputedStyle(v):null,T=S?S.flexDirection:null,E=u(e,"sizes")||_.map((function(){return 100/_.length})),w=u(e,"minSize",100),b=Array.isArray(w)?w:_.map((function(){return w})),I=u(e,"expandToMin",!1),D=u(e,"gutterSize",10),A=u(e,"gutterAlign","center"),k=u(e,"snapOffset",30),M=u(e,"dragInterval",1),L=u(e,"direction",a),N=u(e,"cursor",L===a?"col-resize":"row-resize"),O=u(e,"gutter",p),P=u(e,"elementStyle",g),U=u(e,"gutterStyle",m);function x(t,e,n,o){var s=P(i,e,n,o);Object.keys(s).forEach((function(e){t.style[e]=s[e]}))}function R(){return C.map((function(t){return t.size}))}function F(t){return"touches"in t?t.touches[0][l]:t[l]}function B(t){var e=C[this.a],i=C[this.b],n=e.size+i.size;e.size=t/this.size*n,i.size=n-t/this.size*n,x(e.element,e.size,this._b,e.i),x(i.element,i.size,this._c,i.i)}function z(t){var i,n=C[this.a],o=C[this.b];this.dragging&&(i=F(t)-this.start+(this._b-this.dragOffset),M>1&&(i=Math.round(i/M)*M),i<=n.minSize+k+this._b?i=n.minSize+this._b:i>=this.size-(o.minSize+k+this._c)&&(i=this.size-(o.minSize+this._c)),B.call(this,i),u(e,"onDrag",r)(R()))}function W(){var t=C[this.a].element,e=C[this.b].element,n=t.getBoundingClientRect(),o=e.getBoundingClientRect();this.size=n[i]+o[i]+this._b+this._c,this.start=n[h],this.end=n[f]}function G(t){var e=function(t){if(!getComputedStyle)return null;var e=getComputedStyle(t);if(!e)return null;var i=t[y];return 0===i?null:i-=L===a?parseFloat(e.paddingLeft)+parseFloat(e.paddingRight):parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)}(v);if(null===e)return t;if(b.reduce((function(t,e){return t+e}),0)>e)return t;var i=0,n=[],o=t.map((function(o,s){var a=e*o/100,r=c(D,0===s,s===t.length-1,A),l=b[s]+r;return a<l?(i+=l-a,n.push(0),l):(n.push(a-l),a)}));return 0===i?t:o.map((function(t,o){var s=t;if(i>0&&n[o]-i>0){var a=Math.min(i,n[o]-i);i-=a,s=t-a}return s/e*100}))}function j(){var t=this,i=C[t.a].element,o=C[t.b].element;t.dragging&&u(e,"onDragEnd",r)(R()),t.dragging=!1,n.removeEventListener("mouseup",t.stop),n.removeEventListener("touchend",t.stop),n.removeEventListener("touchcancel",t.stop),n.removeEventListener("mousemove",t.move),n.removeEventListener("touchmove",t.move),t.stop=null,t.move=null,i.removeEventListener("selectstart",r),i.removeEventListener("dragstart",r),o.removeEventListener("selectstart",r),o.removeEventListener("dragstart",r),i.style.userSelect="",i.style.webkitUserSelect="",i.style.MozUserSelect="",i.style.pointerEvents="",o.style.userSelect="",o.style.webkitUserSelect="",o.style.MozUserSelect="",o.style.pointerEvents="",t.gutter.style.cursor="",t.parent.style.cursor="",s.body.style.cursor=""}function K(t){if(!("button"in t)||0===t.button){var i=this,o=C[i.a].element,a=C[i.b].element;i.dragging||u(e,"onDragStart",r)(R()),t.preventDefault(),i.dragging=!0,i.move=z.bind(i),i.stop=j.bind(i),n.addEventListener("mouseup",i.stop),n.addEventListener("touchend",i.stop),n.addEventListener("touchcancel",i.stop),n.addEventListener("mousemove",i.move),n.addEventListener("touchmove",i.move),o.addEventListener("selectstart",r),o.addEventListener("dragstart",r),a.addEventListener("selectstart",r),a.addEventListener("dragstart",r),o.style.userSelect="none",o.style.webkitUserSelect="none",o.style.MozUserSelect="none",o.style.pointerEvents="none",a.style.userSelect="none",a.style.webkitUserSelect="none",a.style.MozUserSelect="none",a.style.pointerEvents="none",i.gutter.style.cursor=N,i.parent.style.cursor=N,s.body.style.cursor=N,W.call(i),i.dragOffset=F(t)-i.end}}L===a?(i="width",l="clientX",h="left",f="right",y="clientWidth"):"vertical"===L&&(i="height",l="clientY",h="top",f="bottom",y="clientHeight"),E=G(E);var $=[];function V(t){var e=t.i===$.length,i=e?$[t.i-1]:$[t.i];W.call(i);var n=e?i.size-t.minSize-i._c:t.minSize+i._b;B.call(i,n)}return(C=_.map((function(t,e){var n,o={element:d(t),size:E[e],minSize:b[e],i:e};if(e>0&&((n={a:e-1,b:e,dragging:!1,direction:L,parent:v})._b=c(D,e-1==0,!1,A),n._c=c(D,!1,e===_.length-1,A),"row-reverse"===T||"column-reverse"===T)){var s=n.a;n.a=n.b,n.b=s}if(e>0){var a=O(e,L,o.element);!function(t,e,n){var o=U(i,e,n);Object.keys(o).forEach((function(e){t.style[e]=o[e]}))}(a,D,e),n._a=K.bind(n),a.addEventListener("mousedown",n._a),a.addEventListener("touchstart",n._a),v.insertBefore(a,o.element),n.gutter=a}return x(o.element,o.size,c(D,0===e,e===_.length-1,A),e),e>0&&$.push(n),o}))).forEach((function(t){var e=t.element.getBoundingClientRect()[i];e<t.minSize&&(I?V(t):t.minSize=e)})),{setSizes:function(t){var e=G(t);e.forEach((function(t,i){if(i>0){var n=$[i-1],o=C[n.a],s=C[n.b];o.size=e[i-1],s.size=t,x(o.element,o.size,n._b,o.i),x(s.element,s.size,n._c,s.i)}}))},getSizes:R,collapse:function(t){V(C[t])},destroy:function(t,e){$.forEach((function(n){if(!0!==e?n.parent.removeChild(n.gutter):(n.gutter.removeEventListener("mousedown",n._a),n.gutter.removeEventListener("touchstart",n._a)),!0!==t){var o=P(i,n.a.size,n._b);Object.keys(o).forEach((function(t){C[n.a].element.style[t]="",C[n.b].element.style[t]=""}))}}))},parent:v,pairs:$}}},326:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class i{static getInitialLocation(){return""===this.initialLocation?null:JSON.parse(this.initialLocation)}static setInitialLocation(t){""===this.initialLocation&&(this.initialLocation=JSON.stringify(t))}static getName(){return null==this.username&&(this.username=localStorage.getItem("tmp-config-name")||""),this.username}static setName(t){t!==this.username&&(this.username=t,localStorage.setItem("tmp-config-name",t))}static getMemberType(){return this.memberType}static setMemberType(t){this.memberType=t}static getApiKey(){return this.apiKey}static setApiKey(t){this.apiKey=t}static getDebugLevel(){return this.debugLevel}static setDebugLevel(t){this.debugLevel=t}static getAuthUrl(){return this.authUrl}static setAuthUrl(t){""===t||t===i.BROWSER_AUTH?this.authUrl=t:this.authUrl=t+(t.endsWith("/")?"":"/")}static getAuthType(){return""===this.authUrl?"none":this.authUrl===i.BROWSER_AUTH?"browser":"server"}static useServer(){return"server"===this.getAuthType()}static getUserType(){return this.userType}static setUserType(t){this.userType=t}static getZoomUrl(){return this.zoomUrl}static setZoomUrl(t){!0===this.useServer()&&!0===t.startsWith("https://")?this.zoomUrl=t:this.zoomUrl=""}static isZoomAvailable(){return this.zoomUrl.startsWith("https://")}static isZoomUrlValid(t){return""===t||t.startsWith("https://")}static getCaptionErrorCount(){return this.captionErrorCount}static incrementCaptionErrorCount(){return this.captionErrorCount++,this.captionErrorCount}static resetCaptionErrorCount(){this.captionErrorCount=0}}i.BROWSER_AUTH="browser",i.initialLocation="",i.memberType="",i.apiKey="",i.debugLevel=1,i.authUrl="",i.userType="",i.zoomUrl="",i.captionErrorCount=0,e.default=i},344:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Apis=void 0;const o=n(i(326));var s;(s=e.Apis||(e.Apis={})).isFetchConfigResponse=t=>{const e=t;return"string"==typeof(null==e?void 0:e.api_key)&&"number"==typeof(null==e?void 0:e.debug_level)&&"string"==typeof(null==e?void 0:e.subtitler_url_key)&&"string"==typeof(null==e?void 0:e.auth_url)},s.queryRoom=t=>{const e=o.default.getAuthUrl();return fetch(e+t)},s.HIDE="0",s.SHOW="1",s.isGetRoomResponse=t=>{const e=t;return"string"==typeof(null==e?void 0:e.ip)&&"string"==typeof(null==e?void 0:e.vn)&&"string"==typeof(null==e?void 0:e.vp)},s.loginRoom=t=>{const e=o.default.getAuthUrl()+"login",i=new URLSearchParams;return i.append("roomHash",t.roomHash),i.append("userName",t.userName),i.append("userType",t.userType),i.append("pass",t.password),fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i})},s.isPostLoginResponse=t=>{var e,i,n;const o=t;return"string"==typeof(null==o?void 0:o.id)&&"string"==typeof(null==o?void 0:o.roomName)&&"string"==typeof(null==o?void 0:o.zoomUrl)&&"number"==typeof(null===(e=null==o?void 0:o.credential)||void 0===e?void 0:e.timestamp)&&"number"==typeof(null===(i=null==o?void 0:o.credential)||void 0===i?void 0:i.ttl)&&"string"==typeof(null===(n=null==o?void 0:o.credential)||void 0===n?void 0:n.authToken)},s.logoutRoom=()=>{const t=o.default.getAuthUrl()+"logout",e=new URLSearchParams;return fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e})},s.updateZoom=t=>{const e=o.default.getAuthUrl()+"zoom",i=new URLSearchParams;return i.append("url",t.url),fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i})},s.sendCaption=t=>{const e=o.default.getAuthUrl()+"captions",i=new URLSearchParams;return i.append("message",t.message),fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i})},s.MAX_ERROR_SENDING_CAPTION=5},752:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i(65)),l=a(i(110)),h=a(i(734)),d=a(i(222)),u=i(150),c=i(771),p=i(702),g=i(144),m=i(877),f=i(882),y=i(293),C=i(79),_=i(323),v=i(165),S=i(900),T=i(808),E=i(359),w=i(239),b=s(i(580)),I=i(795),D=i(43),A=a(i(956)),k=a(i(326)),M=i(534),L=a(i(572)),N=a(i(263)),O=i(344);e.default=class{constructor(){this.id="",this.roomName="",this.pageTitle="",this.isViewer=!1,this.isErrorHandling=!1;const t=localStorage.getItem("config");null!=t&&(l.default.w("Info","config found in localStorage"),D.AppConfig.trySetJSON(t));const e=D.AppConfig.data.getLocale();l.default.w("Info",`locale:${e}`),v.T.setLocale(e),k.default.setInitialLocation(document.location),window.addEventListener("beforeunload",(t=>{this.onBeforeUnload(t)})),window.addEventListener("unload",(t=>{this.onUnload(t)})),E.UtilDom.makeDialogsRespondToKey(),this.dialogInput=new A.default,this.dialogNotify=new N.default,this.configFileController=new b.default("cfg-file-opener"),this.dialogConfig=new I.DialogConfig,this.dialogConfigViewer=new M.DialogConfigViewer,this.setConfigDialogEvents();const i=this.makeCommEventHandlers();this.comm=new r.default(i),this.appControl=new h.default,this.setAppControlEvents(),this.paneContainer1=new w.PaneContainer1,this.paneContainer2=new w.PaneContainer2,this.paneContainer3=new w.PaneContainer3,this.dialogLogin=new d.default,this.setLoginDialogEvents(),this.dialogLogin.hidePass(),this.dialogLogin.setName(k.default.getName());const n=this.getInitialRoomIfLegit();""!==n&&(this.dialogLogin.setRoom(n),this.dialogLogin.hideRoom()),this.updatePageTitleWithRoom(n),f.Util.contains(navigator.userAgent,"MSIE","Trident","Edge")||(document.getElementById("shutter").style.display="none",this.dialogLogin.showDialog()),this.fetchConfig().then((t=>{!0!==t&&(this.dialogLogin.hideDialog(),this.dialogNotify.showDialog(v.T.t("Error","General"),v.T.t("No Room.","Login"),!1))})),this.paneMain=new S.PaneMain,this.paneFkey=new c.PaneFkey,this.paneInput=new u.PaneInput,this.setInputEvents(),this.paneMonitor=new p.PaneMonitor,this.setMonitorEvents(),this.paneChat=new y.PaneChat,this.setChatEvents(),this.pftFileController=new b.default("pft-file-opener"),this.panePft=new C.PanePft,this.setPftEvents(),this.panePftMon=new _.PanePftMon,this.panes={i:this.paneInput,r:this.paneChat,p:this.panePft,f:this.paneFkey},this.localize(),this.setEvents()}sendMain(t){const e=g.ContentUtil.makeDisplayData(t),i=this.comm.send_room(e),n=g.ContentClass.fromSendData(this.id,i);this.paneMain.addNewItem(n)}sendGross(t){const e=t.join("\n"),i=g.ContentUtil.makeGrossData(e),n=this.comm.send_room(i),o=g.ContentClass.fromSendData(this.id,n);this.paneMain.addNewGross(o)}getInitialRoomIfLegit(){var t;const e=k.default.getInitialLocation(),i=null===(t=null==e?void 0:e.search)||void 0===t?void 0:t.substring(1);if(null==i)return"";const n=f.Util.extractPossibleRoomName(i);return f.Util.isRoomNameLegit(n)?n:""}updateUrlWithRoom(t){const e=f.Util.makeQueryStringWithNewRoom(t,E.UtilDom.getQuery());E.UtilDom.setQuery(e)}updatePageTitleWithRoom(t,e=!0){t.length>0?this.updatePageTitle(v.T.t("Room","General")+" "+t):this.updatePageTitle("")}updatePageTitle(t,e=!0){this.pageTitle.length<1&&(this.pageTitle=document.title),t.length<1?document.title=this.pageTitle:document.title=e?t+" - "+this.pageTitle:this.pageTitle+" - "+t}async fetchConfig(){try{const t=await fetch("config.json?"+Date.now().toString()),e=await t.json();if(!0!==this.onConfigFetch(e))return!1}catch(t){return l.default.w("Error",`Error in fetching config. message:${t}`),!1}const t=k.default.getAuthType();if("none"===t)return!0;if("browser"===t)return this.dialogLogin.showPass(),!0;const e=this.getInitialRoomIfLegit();if(null==e||""==e)return this.dialogLogin.showName(),this.dialogLogin.showPass(),!0;try{const t=await O.Apis.queryRoom(e);if(t.ok){const e=await t.json();return this.onRoomFetch(e)}return!1}catch(t){return l.default.w("Error",`Error in querying room. Message:${t}`),!1}}onConfigFetch(t){return!!O.Apis.isFetchConfigResponse(t)&&(k.default.setApiKey(t.api_key),this.dialogLogin.enableLogin(),k.default.setDebugLevel(t.debug_level),k.default.setAuthUrl(t.auth_url),k.default.setUserType(""),this.dialogLogin.clearRole(),null!=t.subtitler_url_key&&""!==t.subtitler_url_key&&(f.Util.queryString2kvArray(E.UtilDom.getQuery()).some((e=>e.key===t.subtitler_url_key))?(k.default.setUserType("wi"),this.dialogLogin.fixRoleAsSubtitler()):(k.default.setUserType("wv"),this.dialogLogin.fixRoleAsViewer())),!0)}onRoomFetch(t){if(!O.Apis.isGetRoomResponse(t))return!1;const e=(t,e)=>{t===O.Apis.HIDE?this.dialogLogin.hideName():this.dialogLogin.showName(),e===O.Apis.HIDE?this.dialogLogin.hidePass():this.dialogLogin.showPass()};switch(k.default.getUserType()){case"wi":e(O.Apis.SHOW,t.ip);break;case"wv":e(t.vn,t.vp);break;default:e(O.Apis.SHOW,O.Apis.SHOW)}return!0}setConfigDialogEvents(){this.configFileController.onLoad=t=>{var e;if(null==(null===(e=t.target)||void 0===e?void 0:e.result))return;l.default.w("Info","Config opened.");const i=t.target.result;D.AppConfig.trySetJSON(i),this.reflectNewConfig(),this.dialogConfig.configToDialog(),this.dialogConfigViewer.configToDialog()},this.dialogConfig.setOnSet((t=>{this.updateSomeConfigs(t)})),this.dialogConfigViewer.setOnSet((t=>{this.updateSomeConfigs(t)})),this.dialogConfig.onResetClicked=()=>{D.AppConfig.resetAll(),this.reflectNewConfig(),this.dialogConfig.configToDialog(),this.dialogConfigViewer.configToDialog()},this.dialogConfigViewer.onResetClicked=()=>{D.AppConfig.resetAll(),this.reflectNewConfig(),this.dialogConfig.configToDialog(),this.dialogConfigViewer.configToDialog()},this.dialogConfig.onOpenClicked=()=>{this.configFileController.openDialogAndReadFile(D.AppConfig.getExtensionMekikuWeb())},this.dialogConfigViewer.onOpenClicked=()=>{this.configFileController.openDialogAndReadFile(D.AppConfig.getExtensionMekikuWeb())},this.dialogConfig.onSaveClicked=()=>{this.dialogInput.onOkClick=t=>{b.Downloader.start(t,D.AppConfig.getJSON())};const t=v.T.t("file name","General"),e=f.Util.getIsoStyleDateString()+D.AppConfig.getExtensionMekikuWeb();this.dialogInput.showDialog(t,e)},this.dialogConfigViewer.onSaveClicked=()=>{this.dialogInput.onOkClick=t=>{b.Downloader.start(t,D.AppConfig.getJSON())};const t=v.T.t("file name","General"),e=f.Util.getIsoStyleDateString()+D.AppConfig.getExtensionMekikuWeb();this.dialogInput.showDialog(t,e)},this.configFileController.onError=(t,e)=>{var i;alert(`Error loading ${e.name} : ${null===(i=t.target)||void 0===i?void 0:i.error}`)}}setAppControlEvents(){this.appControl.onLogout=()=>{this.comm.send_room(g.ContentUtil.makeLogoffData()),this.comm.leaveRoom(),"server"===k.default.getAuthType()&&(async()=>{const t=await O.Apis.logoutRoom();!0!==t.ok&&l.default.w("Error",`Logout POST failed : ${t.status}:${t.statusText}`)})()},this.appControl.onSetting=()=>{this.isViewer?this.dialogConfigViewer.showDialog():this.dialogConfig.showDialog()}}setLoginDialogEvents(){this.dialogLogin.onDownloadMain=()=>{const t=f.Util.getIsoModifiedDateTimeString()+"_main.log",e=this.paneMain.getMainLog().join(f.Util.getNewLineCode());b.Downloader.start(t,e)},this.dialogLogin.onDownloadChat=()=>{const t=f.Util.getIsoModifiedDateTimeString()+"_chat.log",e=this.paneChat.getLog();b.Downloader.start(t,e)},this.dialogLogin.onLoginClick=t=>{switch(this.loginInfo=t,k.default.setName(t.name),k.default.setMemberType(t.memberType),k.default.getAuthType()){case"none":case"browser":this.doLogin(t);break;case"server":(async()=>{try{const e=await O.Apis.loginRoom({roomHash:t.room,userName:t.name,userType:t.memberType,password:t.pass});if(!0!==e.ok)return l.default.w("Error",`Login POST failed : ${e.status}:${e.statusText}`),void this.dialogLogin.showDialogWithMessage(v.T.t("Login failed.","Login"));const i=await e.json();if(!O.Apis.isPostLoginResponse(i))return void this.dialogNotify.showDialog(v.T.t("Error","General"),v.T.t("System error.","General"),!1);k.default.setZoomUrl(i.zoomUrl),this.doLogin(t,{id:i.id,credential:i.credential})}catch(t){return void l.default.w("Error",`Error in login. Message:${t}`)}})();break;default:throw new Error("wrong authentication type!")}}}doLogin(t,e){const i=t,n={handleOpen:t=>{this.comm.joinRoom(i).then((()=>{})).catch((t=>{}))},debugLevel:k.default.getDebugLevel(),...e};this.comm.open(k.default.getApiKey(),n);const o=this.getInitialRoomIfLegit(),s=t.room;""===o&&(this.updatePageTitleWithRoom(s),this.updateUrlWithRoom(s)),this.roomName=s,this.paneMonitor.clearMembers(),t.memberType===g.MemberType.WEB_VIEWER?this.setViewerStyle():this.setSubtitlerStyle()}setInputEvents(){this.paneInput.setGetFkey((t=>this.paneFkey.getFKey(t))),this.paneInput.setDoOnInput((t=>{this.comm.queue_room(g.ContentUtil.makeMonitorData(t))})),this.paneInput.setDoOnEnter((t=>{this.sendMain(t),k.default.isZoomAvailable()&&(async t=>{const e=await O.Apis.sendCaption({message:t});1==e.ok?k.default.resetCaptionErrorCount():(l.default.w("Error",`Error in sending caption. status:${e.status}/${e.statusText}`),k.default.incrementCaptionErrorCount()>=O.Apis.MAX_ERROR_SENDING_CAPTION&&(this.sendChatSystemMessage(g.ChatSystemType.WARNING,v.T.t("Failed sending captions.","Chat")),k.default.resetCaptionErrorCount()))})(t)})),this.paneInput.setDoOnUndo((()=>{const t=this.paneMain.undoLastItem();if(null==t)return"";const e=g.ContentUtil.makeUndoData(t.id,t.sentMsec);return this.comm.send_room(e),t.content}))}setMonitorEvents(){this.paneMonitor.setOnNewJoined((t=>{t.memberType===g.MemberType.WEB_SUBTITLER?this.paneChat.addSystemMessage(`(${v.T.t("login","Chat")} : ${t.name})`):this.paneChat.addSystemMessage(`(${v.T.t("New viewer","Chat")} : ${t.name})`)})),this.paneMonitor.setOnLeft((t=>{t.memberType===g.MemberType.WEB_SUBTITLER?this.paneChat.addSystemMessage(`(${v.T.t("logout","Chat")} : ${t.name})`):this.paneChat.addSystemMessage(`(${v.T.t("A viewer left","Chat")} : ${t.name})`)}))}setChatEvents(){this.paneChat.setGetFkey((t=>this.paneFkey.getFKey(t))),this.paneChat.setOnSend((t=>{this.comm.send_room(g.ContentUtil.makeChatData(t)),this.paneChat.addMessage(k.default.getName(),t)})),this.paneChat.setOnSendSystem(((t,e)=>{this.sendChatSystemMessage(t,e)}))}sendChatSystemMessage(t,e){this.comm.send_room(g.ContentUtil.makeChatSystemData(t,e)),this.paneChat.addChatSystemMessage(k.default.getName(),t,e)}setPftEvents(){this.panePft.setOnSend((t=>{this.sendMain(t)})),this.panePft.setOnGross((t=>{this.sendGross(t)})),this.panePft.setOnChange(((t,e)=>{const i=t.join("\n"),n=e.join("\n"),o=this.comm.queue_room(g.ContentUtil.makePftMonData(i,n));this.panePftMon.update(o.A,o.B,o)})),this.panePft.setGetFkey((t=>this.paneFkey.getFKey(t))),this.panePft.setOnOpenCommand((t=>{this.pftFileController.openDialogAndReadFile(".mk8,.txt")})),this.panePft.setOnSaveCommand(((t,e)=>{const i=v.T.t("file name","General");this.dialogInput.onOkClick=e=>{this.panePft.NotifyPftSaved(e),b.Downloader.start(e,t)},this.dialogInput.showDialog(i,e)})),this.pftFileController.onLoad=(t,e,i)=>{var n;null!=(null===(n=t.target)||void 0===n?void 0:n.result)&&this.panePft.NotifyPftOpened(i,e)},this.pftFileController.onError=(t,e)=>{var i;alert(`Error loading ${e.name} : ${null===(i=t.target)||void 0===i?void 0:i.error}`)}}reflectNewConfig(){const t=D.AppConfig.data.getLocale();l.default.w("Info",`new config : locale=[${t}]`),v.T.setLocale(t),this.updateAllConfig()}setSubtitlerStyle(){this.isViewer=!1,this.setSplits(),this.paneMain.setViewerMode(this.isViewer),this.paneMain.updateConfig(),this.appControl.hideShortState(),this.paneContainer2.show(),this.paneContainer3.show(),this.paneContainer1.setDefault(),this.paneInput.show(),this.paneMonitor.show(),this.appControl.goBottom(),this.paneInput.focus()}setViewerStyle(){this.isViewer=!0,this.unsetSplits(),this.paneMain.setViewerMode(this.isViewer),this.paneMain.updateConfig(),this.appControl.showShortState(),this.paneContainer2.hide(),this.paneContainer3.hide(),this.paneContainer1.setFullWidth(),this.paneInput.hide(),this.paneMonitor.hide(),this.appControl.goTop()}updateSomeConfigs(t){for(var e of t)switch(l.default.w("Info",`config updated [${e}]`),e){case"misc":this.updateConfig();break;case"zoom":(async()=>{const t=await O.Apis.updateZoom({url:k.default.getZoomUrl()});!0===t.ok?this.comm.queue_room(g.ContentUtil.makeZoomData(k.default.getZoomUrl())):l.default.w("Error",`Error in updating zoom api key. status:${t.status}/${t.statusText}`)})();break;case"main":this.paneMain.updateConfig();break;case"input":this.paneInput.updateConfig();break;case"chat":this.paneChat.updateConfig();break;case"monitor":this.paneMonitor.updateConfig();break;case"pft":this.panePft.updateConfig();break;case"pftMon":this.panePftMon.updateConfig();break;case"fkey":this.paneFkey.updateConfig()}}updateAllConfig(){this.updateConfig(),this.paneMain.updateConfig(),this.paneInput.updateConfig(),this.paneChat.updateConfig(),this.paneMonitor.updateConfig(),this.panePft.updateConfig(),this.panePftMon.updateConfig(),this.paneFkey.updateConfig()}updateConfig(){const t=D.AppConfig.data.getLocale();v.T.setLocale(t),this.localizeAll()}setSplits(){null==this.splitContainer?this.splitContainer=L.default(["#pane1","#pane2","#pane3"],{sizes:[D.AppConfig.data.misc_pane1_width,D.AppConfig.data.misc_pane2_width,D.AppConfig.data.misc_pane3_width],direction:"horizontal",gutterSize:6,onDragEnd:t=>{D.AppConfig.data.misc_pane1_width=t[0],D.AppConfig.data.misc_pane2_width=t[1],D.AppConfig.data.misc_pane3_width=t[2],this.paneMain.updateScreen()}}):this.splitContainer.setSizes([D.AppConfig.data.misc_pane1_width,D.AppConfig.data.misc_pane2_width,D.AppConfig.data.misc_pane3_width]),null==this.splitDisplayMonitor?this.splitDisplayMonitor=L.default(["#display-input","#monitor"],{sizes:[D.AppConfig.data.misc_display_input_height,D.AppConfig.data.misc_monitor_height],direction:"vertical",gutterSize:6,onDragEnd:t=>{D.AppConfig.data.misc_display_input_height=t[0],D.AppConfig.data.misc_monitor_height=t[1],this.paneMain.updateScreen()}}):this.splitDisplayMonitor.setSizes([D.AppConfig.data.misc_display_input_height,D.AppConfig.data.misc_monitor_height]),null==this.splitPft?this.splitPft=L.default(["#pft","#pftMon"],{sizes:[D.AppConfig.data.misc_pft_height,D.AppConfig.data.misc_pftmon_height],direction:"vertical",gutterSize:6,onDragEnd:t=>{D.AppConfig.data.misc_pft_height=t[0],D.AppConfig.data.misc_pftmon_height=t[1]}}):this.splitPft.setSizes([D.AppConfig.data.misc_pft_height,D.AppConfig.data.misc_pftmon_height])}unsetSplits(){null!=this.splitContainer&&(this.splitContainer.destroy(!0),delete this.splitContainer),null!=this.splitDisplayMonitor&&(this.splitDisplayMonitor.destroy(!0),delete this.splitDisplayMonitor),null!=this.splitPft&&(this.splitPft.destroy(!0),delete this.splitPft)}localizeAll(){this.localize(),this.paneInput.localize(),this.paneChat.localize(),this.paneMonitor.localize(),this.panePft.localize(),this.panePftMon.localize(),this.paneFkey.localize()}onPeerIdAcquired(t){this.id=t}onJoined(){this.paneMain.updateScreen(),this.comm.send_room(g.ContentUtil.makeLoginData())}onLeft(){if(null==this.dialogLogin)return;if(this.isErrorHandling)return;if(this.dialogLogin.isShown())return;this.dialogLogin.setRoom(this.roomName),this.dialogLogin.setName(k.default.getName()),""===this.getInitialRoomIfLegit()&&(this.updatePageTitleWithRoom(""),this.updateUrlWithRoom("")),this.paneMonitor.clearMembers();const t=k.default.getMemberType()===g.MemberType.WEB_SUBTITLER,e=this.paneMain.hasMainLog()&&t,i=this.paneChat.hasLog()&&t;this.dialogLogin.showDialog(e,i)}onSomeoneJoined(t){}onSomeoneLeft(t){this.paneMonitor.deleteMember(t)}onReceived(t){l.default.w("Error",`onReceived data=${JSON.stringify(t)}`);const e=m.MemberInfoClass.fromContent(t);if(g.ContentType.LOGIN in t&&this.comm.send_room(g.ContentUtil.makeResponseData()),g.ContentType.RESPONSE,g.ContentUtil.hasDisplayData(t)){const e=T.MekikuUnitDataClass.fromContent(t);e.contentType=g.ContentType.DISPLAY,e.content=t.D,this.paneMain.notifyNewItem(e)}g.ContentUtil.hasGrossData(t)&&this.paneMain.addNewGross(t),g.ContentUtil.hasUndoData(t)&&this.paneMain.addNewUndo(t),g.ContentUtil.hasZoomData(t)&&(l.default.w("Debug",`Zoom data received. URL=${t.Z}`),k.default.setZoomUrl(t.Z)),g.ContentType.HB,k.default.getMemberType()===g.MemberType.WEB_SUBTITLER&&(g.ContentUtil.hasChatData(t)&&this.paneChat.addMessage(t.senderName,t.C),g.ContentUtil.hasChatSystemData(t)&&this.paneChat.addChatSystemMessage(t.senderName,t.C_TYPE,t.C_ARG),g.ContentUtil.hasMonitorData(t)&&(e.inputContent=t.M),g.ContentUtil.hasPftMonData(t)&&this.panePftMon.update(t.A,t.B,t)),g.ContentType.LOGOFF in t?this.paneMonitor.deleteMember(t.senderID):this.paneMonitor.updateMember(e,t),this.paneMain.notifyNewItemsFinish()}onAuthError(){this.dialogNotify.onOkClick=()=>{this.onLeft()},this.dialogNotify.showDialog(v.T.t("Error","General"),v.T.t("Login failed.","Login"))}onCommunicationError(t){this.isErrorHandling=!0,this.comm.leaveRoom(),this.dialogNotify.onOkClick=()=>{this.isErrorHandling=!1,this.onLeft()};const e=null!=t.message?"\n"+v.T.t("Detail","General")+" : "+t.message:"";this.dialogNotify.showDialog(v.T.t("Error","General"),v.T.t("Communication error.","General")+e)}onSomeError(t){this.isErrorHandling=!0,this.comm.leaveRoom(),this.dialogNotify.onOkClick=()=>{this.isErrorHandling=!1,this.onLeft()};const e=null!=t.message?"\n"+v.T.t("Detail","General")+" : "+t.message:"";this.dialogNotify.showDialog(v.T.t("Error","General"),v.T.t("Communication error.","General")+e)}onPeerError(t){"authentication"===t.type?this.onAuthError():"socket-error"===t.type?this.onCommunicationError(t):this.onSomeError(t)}makeCommEventHandlers(){const t=new r.MekikuCommEvents;return t.onPeerIdAcquired=t=>{this.onPeerIdAcquired(t)},t.onPeerError=t=>{this.onPeerError(t)},t.onJoinedRoom=()=>{this.onJoined()},t.onLeftRoom=()=>{this.onLeft()},t.onReceived=t=>{this.onReceived(t)},t.onSomeoneJoined=t=>{this.onSomeoneJoined(t)},t.onSomeoneLeft=t=>{this.onSomeoneLeft(t)},t.logger=t=>{l.default.w("Comm",t)},t}onBeforeUnload(t){var e;if(!0===(null===(e=this.comm)||void 0===e?void 0:e.isInRoom()))return t.preventDefault(),t.returnValue="Truly exit?","Truly exit?"}onUnload(t){var e;!0===(null===(e=this.comm)||void 0===e?void 0:e.isInRoom())&&(this.comm.send_room(g.ContentUtil.makeLogoffData()),this.comm.leaveRoom());const i=D.AppConfig.getJSON();localStorage.setItem("config",i)}setEvents(){window.addEventListener("resize",(t=>{this.paneMain.updateScreen()})),document.addEventListener("visibilitychange",(t=>{document.hidden&&this.paneMain.stopScrollAndJumpToLatest()})),document.addEventListener("keydown",(t=>{"F5"===t.key&&this.comm.isInRoom()&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()),"F1"===t.key&&this.comm.isInRoom()&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation());const e=E.UtilDom.isCommandOrControlPressed(t)&&!t.shiftKey;if(e){const e=t.key.toLowerCase();e in this.panes&&(this.panes[e].focus(),t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation())}"o"===t.key&&e&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()),"s"===t.key&&e&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation())}))}localize(){const t=document.getElementsByClassName("l10n");for(const i of t){const t=i.id,n=document.getElementById(t);if(null===n)continue;const o=n.dataset.key,s=n.textContent;var e;if(null!=o)e=o;else{if(null==s){l.default.w("Warning",`app.localize element[${t}] no textContent.`);continue}e=s,n.dataset.key=e}const a=n.dataset.context;if(void 0===a){l.default.w("Warning",`app.localize element[${t}] data-context not exists.`);continue}const r=v.T.t(e,a);n.textContent=r}const i=document.getElementsByClassName("title-l10n");for(const t of i){const e=t.id,i=document.getElementById(e);if(null===i)continue;const n=i.title;if(null===n)continue;const o=i.dataset.context;if(void 0===o)continue;const s=v.T.t(n,o);i.title=s}}}},43:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AppConfig=void 0;const n=i(165);class o{constructor(){this._misc_locale="",this.misc_pane1_width=45,this.misc_pane2_width=25,this.misc_pane3_width=30,this.misc_display_input_height=65,this.misc_monitor_height=35,this.misc_pft_height=50,this.misc_pftmon_height=50,this.main_font_familyName="",this.main_font_size=24,this.main_font_isBold=!1,this.main_foreColor="#ffffff",this.main_backColor="#000000",this.main_outline_enabled=!1,this.main_outline_color="#80ff80",this.main_outline_width=2,this.main_scrollMsec=200,this.main_lineHeight=140,this.main_v_font_familyName="",this.main_v_font_size=28,this.main_v_font_isBold=!1,this.main_v_foreColor="#ffffff",this.main_v_backColor="#000000",this.main_v_outline_enabled=!1,this.main_v_outline_color="#80ff80",this.main_v_outline_width=2,this.main_v_scrollMsec=200,this.main_v_lineHeight=140,this.input_font_familyName="",this.input_font_size=14,this.input_font_isBold=!1,this.input_foreColor="#000000",this.input_backColor="#ffffff",this.input_parentheses_1="",this.input_parentheses_2="",this.input_parenthesesShift_1="",this.input_parenthesesShift_2="",this.chat_font_familyName="",this.chat_font_size=12,this.chat_font_isBold=!1,this.chat_foreColor="#ffffff",this.chat_backColor="#000000",this.chat_notifyColor="#ff0000",this.chat_timer=5,this.chat_useSound=!0,this.monitor_font_familyName="",this.monitor_font_size=10,this.monitor_font_isBold=!1,this.monitor_foreColor="#ffffff",this.monitor_backColor="#000000",this.pft_font_familyName="",this.pft_font_size=12,this.pft_font_isBold=!1,this.pft_foreColor="#ffffff",this.pft_backColor="#000000",this.pft_nameBackColor="#000000",this.pft_nameOtherBackColor="#333333",this.pft_show_isAll=!0,this.pft_show_active_ratio=100,this.pft_fallbackEncoding="Shift-JIS",this.pftMon_font_familyName="",this.pftMon_font_size=12,this.pftMon_font_isBold=!1,this.pftMon_foreColor="#ffffff",this.pftMon_backColor="#000000",this.fkey_font_familyName="",this.fkey_font_size=10,this.fkey_font_isBold=!1,this.fkey_foreColor="#ffffff",this.fkey_backColor="#000000"}getLocale(){return""===this._misc_locale?n.T.getBrowserLocale():this._misc_locale}setLocale(t){t===n.T.getBrowserLocale()?this._misc_locale="":this._misc_locale=t}getParentheses1_Default(){return n.T.t("“","Config|Input")}getParentheses2_Default(){return n.T.t("”","Config|Input")}getParenthesesShift1_Default(){return n.T.t("(","Config|Input")}getParenthesesShift2_Default(){return n.T.t(")","Config|Input")}getParentheses1(){return""===this.input_parentheses_1?this.getParentheses1_Default():this.input_parentheses_1}setParentheses1(t){if(t===this.getParentheses1_Default()){if(""===this.input_parentheses_1)return!1;this.input_parentheses_1=""}else{if(this.input_parentheses_1===t)return!1;this.input_parentheses_1=t}return!0}getParentheses2(){return""===this.input_parentheses_2?this.getParentheses2_Default():this.input_parentheses_2}setParentheses2(t){if(t===this.getParentheses2_Default()){if(""===this.input_parentheses_2)return!1;this.input_parentheses_2=""}else{if(this.input_parentheses_2===t)return!1;this.input_parentheses_2=t}return!0}getParenthesesShift1(){return""===this.input_parenthesesShift_1?this.getParenthesesShift1_Default():this.input_parenthesesShift_1}setParenthesesShift1(t){if(t===this.getParenthesesShift1_Default()){if(""===this.input_parenthesesShift_1)return!1;this.input_parenthesesShift_1=""}else{if(this.input_parenthesesShift_1===t)return!1;this.input_parenthesesShift_1=t}return!0}getParenthesesShift2(){return""===this.input_parenthesesShift_2?this.getParenthesesShift2_Default():this.input_parenthesesShift_2}setParenthesesShift2(t){if(t===this.getParenthesesShift2_Default()){if(""===this.input_parenthesesShift_2)return!1;this.input_parenthesesShift_2=""}else{if(this.input_parenthesesShift_2===t)return!1;this.input_parenthesesShift_2=t}return!0}limitPftShowActiveRatio(){this.pft_show_active_ratio<125?this.pft_show_active_ratio=100:this.pft_show_active_ratio<175?this.pft_show_active_ratio=150:this.pft_show_active_ratio<250?this.pft_show_active_ratio=200:this.pft_show_active_ratio=300}static get data(){return void 0===o.configNow&&(o.configNow=new o),o.configNow}static getExtensionMekikuWeb(){return".mkw"}static tryApplyNewData(t){for(var e of(this.configNow=new o,Object.keys(t)))e in this.configNow&&typeof this.configNow[e]==typeof t[e]&&(this.configNow[e]=t[e]);return!0}static trySetJSON(t){const e=JSON.parse(t);return this.tryApplyNewData(e)}static getJSON(){return JSON.stringify(o.data)}static resetAll(){o.configNow=new o}}e.AppConfig=o,o.configNow=void 0},734:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const n=i(359);e.default=class{constructor(){this.control=document.getElementById("app_control"),this.shortState=document.getElementById("short_state"),this.setting=document.getElementById("appSetting"),this.logout=document.getElementById("appLogout"),this.onSetting=()=>{},this.onLogout=()=>{},this.setting.addEventListener("click",(t=>{this.onSetting()})),this.logout.addEventListener("click",(t=>{this.onLogout()}))}goTop(){this.control.classList.remove("bottom"),this.control.classList.add("top")}goBottom(){this.control.classList.remove("top"),this.control.classList.add("bottom")}showShortState(){n.UtilDom.displayOn(this.shortState)}hideShortState(){n.UtilDom.displayOff(this.shortState)}}},144:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatSystemType=e.ContentType=e.MemberType=e.ContentUtil=e.ContentClass=e.ContentToSendClass=void 0;const n=i(882);class o{constructor(t,e){this.seqCount=++o.counter,this.sendTimeCount=Date.now(),this.senderName=t,this.memberType=e}}e.ContentToSendClass=o,o.counter=0,e.ContentClass=class{constructor(t){this.seqCount=0,this.sendTimeCount=0,this.senderName="",this.memberType=e.MemberType.WEB_SUBTITLER,this.receiveTimeCount=0,this.senderID="",this.sendTimeCount=Date.now(),this.memberType=t}static fromAny(t,e){return null==e?null:n.Util.isNumber(e.seqCount)&&n.Util.isNumber(e.sendTimeCount)&&n.Util.isString(e.memberType)&&n.Util.isString(e.senderName)?(e.receiveTimeCount=Date.now(),e.senderID=t,e):null}static fromSendData(t,e){const i=e;return i.senderID=t,i.receiveTimeCount=e.sendTimeCount,i}},e.ContentUtil=class{static makeLoginData(){return{L:""}}static makeResponseData(){return{R:""}}static makeDisplayData(t){return{D:t,M:""}}static hasDisplayData(t){return!!t&&null!=t.D&&"string"==typeof t.D}static makeGrossData(t){return{G:t}}static hasGrossData(t){return!!t&&null!=t.G&&"string"==typeof t.G}static makeChatData(t){return{C:t}}static hasChatData(t){return!!t&&null!=t.C&&"string"==typeof t.C}static makeChatSystemData(t,e){return{C_TYPE:t,C_ARG:e}}static hasChatSystemData(t){return!!t&&(null!=t.C_TYPE&&"number"==typeof t.C_TYPE||null!=t.C_ARG&&"string"==typeof t.C_ARG)}static makeMonitorData(t){return{M:t}}static hasMonitorData(t){return!!t&&null!=t.M&&"string"==typeof t.M}static makePftMonData(t,e){return{A:t,B:e}}static hasPftMonData(t){return!!t&&null!=t.A&&null!=t.B&&"string"==typeof t.A&&"string"==typeof t.B}static makeUndoData(t,e){return{U_ID:t,U_SENDTIME:e}}static hasUndoData(t){return!!t&&!(!t.U_ID||!t.U_SENDTIME||"string"!=typeof t.U_ID||"number"!=typeof t.U_SENDTIME)}static makeZoomData(t){return{Z:t}}static hasZoomData(t){return!!t&&null!=t.Z&&"string"==typeof t.Z}static makeLogoffData(){return{F:""}}},e.MemberType={WEB_SUBTITLER:"wi",WEB_VIEWER:"wv"},e.ContentType={LOGIN:"L",RESPONSE:"R",DISPLAY:"D",GROSS:"G",CHAT:"C",MONITOR:"M",PFT_ABOVE:"A",PFT_BELOW:"B",UNDO_ID:"U_ID",UNDO_SENDTIME:"U_SENDTIME",ERASE:"E",LOGOFF:"F",HB:"H"},e.ChatSystemType={NOW:0,START:1,PRECAUTION:30,WARNING:1001}},174:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MainUpdateFlags=e.EstimateResult=e.DisplayLinesClass=e.ContentManager=void 0;const n=i(808),o=i(144);e.ContentManager=class{constructor(){this.MIN_D_MSEC_IN_SAME_ID=-2e4,this.MAX_LOG_SCAN=50,this.MAX_UNDO=5,this.loginMsec=Date.now(),this.log=new Array,this.updateFlags=0,this.indexToAdd=0,this.top=new s}setLoginMsec(t){this.loginMsec=t}getUpdateFlags(){return this.updateFlags}proceedLine(t=1){return this.proceedPosition(this.top,t)}proceedPosition(t,e){var i=!1;if(!0===this.ignoreUndoneLogs(t))i=!0;else for(var n=0;n<e;n++)if(this.isLineAtLastInThisLog(t)){if(this.isLogItemAtLast(t)){i=!0;break}if(t.log++,t.line=0,!0===this.ignoreUndoneLogs(t)){i=!0;break}}else t.line++;return i}ignoreUndoneLogs(t){for(var e=!1;this.isUndone(this.log[t.log]);){if(this.isLogItemAtLast(t)){e=!0;break}t.log++,t.line=0}return e}isLogItemAtLast(t){return t.log>=this.log.length-1}isLineAtLastInThisLog(t){return t.line>=this.log[t.log].lines.length-1}isLogLineAtLast(t){return this.isLogItemAtLast(t)&&this.isLineAtLastInThisLog(t)}getDisplayLog(){let t=new Array;if(this.log.length<1)return t;let e=s.clone(this.top);for(;!this.ignoreUndoneLogs(e)&&(t.push(this.log[e.log].lines[e.line]),!this.proceedPosition(e,1)););return t}getComplements(t){const e=this.log.length-1,i=Math.max(e-t+1,0);for(var n=[],o=e;o>=i&&!(this.log[o].estimatedRecvMsec<this.loginMsec);o--)n.push(this.log[o]);return n}hasLog(){return this.log.length>0}getLog(){return this.log.filter(((t,e,i)=>0==(t.flag&n.MekikuUnitDataFlags.UNDONE))).map(((t,e,i)=>t.content))}loopItems(t){if(0===this.updateFlags)return;const e=l.ERASE|l.GROSS|l.INBETWEEN|l.UNDO,i=0!=(this.updateFlags&e)?this.top.log:this.indexToAdd;this.doLoopItems(i,(e=>t(e)))}loopItemsFromTop(t){this.doLoopItems(this.top.log,(e=>t(e)))}doLoopItems(t,e){const i=this.log.length;for(var n=t;n<i;n++)this.isUndone(this.log[n])||(this.log[n].lines=e(this.log[n]))}undoLastItem(){const t=this.log.length,e=Math.max(t-this.MAX_UNDO,0);for(var i=t-1;i>=e&&this.log[i].contentType!==o.ContentType.ERASE&&this.log[i].contentType!==o.ContentType.GROSS;i--)if(this.isNotUndone(this.log[i]))return this.log[i].flag|=n.MekikuUnitDataFlags.UNDONE,this.updateFlags|=l.CHANGE|l.UNDO,this.log[i];return null}undoItem(t,e){const i=this.log.length,o=Math.max(i-this.MAX_LOG_SCAN,0);for(var s=i-1;s>=o;s--)if(this.log[s].id===t&&this.log[s].sentMsec===e)return!!this.isNotUndone(this.log[s])&&(this.log[s].flag|=n.MekikuUnitDataFlags.UNDONE,!0);return null}notifyPacketEnd(){this.updateFlags=0,this.indexToAdd=this.log.length}updateLog(t){const e=this.doUpdateLog(t);return this.updateFlags|=e,e}doUpdateLog(t){const e=this.MakeBaseFlag(t);if(e===l.NOP)return l.NOP;const i=new n.MekikuUnitDataForEstimate(t);if(i.estimatedRecvMsec<this.loginMsec)return l.NOP;const o=this.scanLog(i);return o.result===r.ADD?(this.log.push(i),e):o.result===r.INSERT?(this.log.splice(o.iInsert,0,i),e|l.INBETWEEN):o.result===r.UPDATE&&this.isNotUndone(this.log[o.iInsert])&&this.isUndone(i)&&0==(e&(l.ERASE|l.GROSS))?(this.log[o.iInsert].flag=n.MekikuUnitDataFlags.UNDONE,l.CHANGE|l.INBETWEEN|l.UNDO):l.NOP}addLog(t){const e=this.MakeBaseFlag(t);if(e===l.NOP)return e;const i=new n.MekikuUnitDataForEstimate(t);return this.log.push(i),this.updateFlags|=e,e}isUndone(t){return 0!=(t.flag&n.MekikuUnitDataFlags.UNDONE)}isNotUndone(t){return 0==(t.flag&n.MekikuUnitDataFlags.UNDONE)}MakeBaseFlag(t){return t.contentType==o.ContentType.ERASE?l.CHANGE|l.ERASE:t.contentType==o.ContentType.GROSS?l.CHANGE|l.GROSS:t.contentType==o.ContentType.UNDO_ID?l.CHANGE|l.UNDO:t.contentType==o.ContentType.DISPLAY?l.CHANGE:l.NOP}scanLog(t){let e=new a;const i=this.log.length;if(i<1)return e.result=r.ADD,e;const n=this.log.length-1,o=Math.max(n-this.MAX_LOG_SCAN,0);for(var s=n;s>=o;s--){const i=this.log[s];if(i.id===t.id){if(i.sentTimeAnyway===t.sentTimeAnyway)return e.result=r.UPDATE,e.iInsert=s,e;if(i.sentTimeAnyway<t.sentTimeAnyway){e.iSameIpFirst=s+1;break}i.receivedMsec-t.receivedMsec>=this.MIN_D_MSEC_IN_SAME_ID&&(e.iSameIpLast=s)}else i.estimatedRecvMsec<=t.estimatedRecvMsec?-1===e.iOtherIpFirst&&(e.iOtherIpFirst=s+1):-1===e.iOtherIpFirst&&(e.iOtherIpLast=s)}return e.iSameIpLast<e.iOtherIpFirst?e.iInsert=e.iSameIpLast:e.iSameIpFirst>e.iOtherIpLast?e.iInsert=e.iSameIpFirst:e.iInsert=Math.max(Math.max(e.iSameIpFirst,e.iOtherIpFirst),Math.min(e.iSameIpLast,e.iOtherIpLast)),e.iInsert>=i?e.result=r.ADD:-1===e.iSameIpFirst&&-1===e.iOtherIpFirst&&i>0?e.result=r.UNIDENTIFIED:e.result=r.INSERT,e}};class s{constructor(t=0,e=0){this.log=0,this.line=0,this.log=t,this.line=e}static clone(t){return new s(t.log,t.line)}}e.DisplayLinesClass=class{constructor(t,e,i){this.lineBegin=t,this.lineEnd=e,this.lines=i}};class a{constructor(){this.iInsert=Number.MAX_SAFE_INTEGER,this.iSameIpFirst=-1,this.iSameIpLast=Number.MAX_SAFE_INTEGER,this.iOtherIpFirst=-1,this.iOtherIpLast=Number.MAX_SAFE_INTEGER}toString(){return`[${this.result}] same[${this.iSameIpFirst}:${this.iSameIpLast}] other[${this.iOtherIpFirst}:${this.iOtherIpLast}]`}}var r,l;!function(t){t[t.NOP=0]="NOP",t[t.ADD=1]="ADD",t[t.INSERT=2]="INSERT",t[t.UPDATE=3]="UPDATE",t[t.UNIDENTIFIED=4]="UNIDENTIFIED",t[t.ERROR=5]="ERROR"}(r=e.EstimateResult||(e.EstimateResult={})),function(t){t[t.NOP=0]="NOP",t[t.CHANGE=1]="CHANGE",t[t.INBETWEEN=2]="INBETWEEN",t[t.UNDO=4]="UNDO",t[t.GROSS=8]="GROSS",t[t.ERASE=16]="ERASE"}(l=e.MainUpdateFlags||(e.MainUpdateFlags={}))},527:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.DetectEncoding=void 0;const o=n(i(110));class s{static detect(t){const e=new Uint8Array(t);if(t.byteLength>=2&&255===e[0]&&254===e[1])return this.ENC_UTF16LE;if(t.byteLength>=2&&254===e[0]&&255===e[1])return this.ENC_UTF16BE;if(t.byteLength>=3&&239===e[0]&&187===e[1]&&191===e[2])return this.ENC_UTF8;var i=0,n=0;let s=new a;const r=t.byteLength<1e3?t.byteLength:1e3;for(var l=0;l<r;l++)l%2==1&&0===e[l]&&i++,l%2==0&&0===e[l]&&n++,s.append(e[l]);return o.default.w("info",`detectEncode : UTF16LE:${i} UTF16BE:${n} UTF8:d${s.nDetect}/e${s.nError}`),i>0&&0===n?this.ENC_UTF16LE:n>0&&0===i?this.ENC_UTF16BE:s.nDetect>0&&0===s.nError?this.ENC_UTF8:this.ENC_UNKNOWN}}e.DetectEncoding=s,s.ENC_UTF8="UTF-8",s.ENC_UTF16LE="UTF-16LE",s.ENC_UTF16BE="UTF-16BE",s.ENC_UNKNOWN="";class a{constructor(){this._nDetect=0,this._nError=0,this.index=0,this.length=0}get nDetect(){return this._nDetect}get nError(){return this._nError}append(t){0===this.index?0==(128&t)?(this._nDetect++,this.reset()):192==(224&t)?(this.length=2,this.index++):224==(240&t)?(this.length=3,this.index++):240==(248&t)?(this.length=4,this.index++):(this._nError++,this.reset()):128!=(192&t)?(this._nError++,this.reset()):this.index===this.length-1?(this._nDetect++,this.reset()):this.index++}reset(){this.index=0,this.length=0}}},795:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.DialogConfig=void 0;const o=i(165),s=i(43),a=i(359),r=n(i(110)),l=n(i(326));e.DialogConfig=class{constructor(){this.container=document.getElementById("config-container"),this.pane=document.getElementById("config"),this.GeneralTab=document.getElementById("menu-general"),this.paren1=document.getElementById("config-input_parentheses_1"),this.paren2=document.getElementById("config-input_parentheses_2"),this.parenShift1=document.getElementById("config-input_parenthesesShift_1"),this.parenShift2=document.getElementById("config-input_parenthesesShift_2"),this.selectLocale=document.getElementById("config-select-locale"),this.buttonOK=document.getElementById("config-button-ok"),this.buttonCancel=document.getElementById("config-button-cancel"),this.buttonOpen=document.getElementById("config-open"),this.buttonSave=document.getElementById("config-save"),this.buttonReset=document.getElementById("config-reset"),this.zoomConfig=document.getElementById("config-general-zoom"),this.zoomApiKey=document.getElementById("config-general-zoom-api"),this.locales=[],this.paneNames=[],this.doOnSet=t=>{},this.onOpenClicked=()=>{},this.onSaveClicked=()=>{},this.onResetClicked=()=>{},this.setTitle(o.T.t("Config","Config")),this.buttonOK.addEventListener("click",(t=>{this.dialogToConfig(),this.hideDialog(),this.doOnSet(this.paneNames)})),this.buttonCancel.addEventListener("click",(t=>{this.hideDialog()})),this.buttonOpen.addEventListener("click",(t=>{this.onOpenClicked()})),this.buttonSave.addEventListener("click",(t=>{this.dialogToConfig(),this.onSaveClicked()})),this.buttonReset.addEventListener("click",(t=>{this.onResetClicked()}))}getChangedPanes(){return this.paneNames}setOnSet(t){this.doOnSet=e=>t(e)}setTitle(t){}showDialog(){if(this.locales.length<1)for(var t of(this.locales=o.T.getLocales(),this.locales))a.UtilDom.addSelectOption(this.selectLocale,t.v2,t.v1);this.configToDialog(),l.default.useServer()?a.UtilDom.displayOn(this.zoomConfig):a.UtilDom.displayOff(this.zoomConfig),this.GeneralTab.click(),a.UtilDom.show(this.container)}hideDialog(){a.UtilDom.hide(this.container)}configToDialog(){const t=this.pane.getElementsByTagName("input"),e=t.length;for(var i=0;i<e;i++){const e=t[i];if(!e.id.startsWith("config_"))continue;const o=e.id.substr(7);if(null!=s.AppConfig.data[o])"text"===e.type||"number"===e.type||"color"===e.type?t[i].value=s.AppConfig.data[o].toString():"checkbox"===e.type?!0===s.AppConfig.data[o]?t[i].checked=!0:!1===s.AppConfig.data[o]?t[i].checked=!1:r.default.w("Warning",`configToDialog checkbox item --- not boolean [${e.id}]`):r.default.w("Warning",`configToDialog type not found id:${o}`);else if(null!=s.AppConfig.data[e.name]){const o=s.AppConfig.data[e.name];if("radio"===e.type){var n=!1;switch(typeof o){case"string":n=o===e.value;break;case"number":n=o===Number(e.value);break;case"boolean":n=o===("true"===e.value.toLowerCase())}n&&(t[i].checked=!0)}else r.default.w("Warning",`configToDialog type not found name:${e.name} (id:${e.id})`)}else r.default.w("Warning",`configToDialog assign failed id:${e.id} name:${e.name}`)}this.paren1.value=s.AppConfig.data.getParentheses1(),this.paren2.value=s.AppConfig.data.getParentheses2(),this.parenShift1.value=s.AppConfig.data.getParenthesesShift1(),this.parenShift2.value=s.AppConfig.data.getParenthesesShift2(),this.zoomApiKey.value=l.default.useServer()?l.default.getZoomUrl():"";var a=0;const h=o.T.matchLocale(s.AppConfig.data.getLocale());for(var d=0;d<this.locales.length;d++)if(this.locales[d].v1===h){a=d;break}this.selectLocale.selectedIndex=a}dialogToConfig(){const t=this.pane.getElementsByTagName("input"),e=t.length;this.paneNames=[];for(var i=0;i<e;i++){if(!t[i].id.startsWith("config_"))continue;var n="";if("radio"===t[i].type){if(!t[i].checked)continue;n=t[i].name}else n=t[i].id.substr(7);if(""!==n&&void 0===s.AppConfig.data[n]){r.default.w("Warning",`dialogToConfig not found : key=${n} element:${t[i].id}`);continue}const e=n.substring(0,n.indexOf("_"));var a=!1;if("string"==typeof s.AppConfig.data[n]||s.AppConfig.data[n]instanceof String)s.AppConfig.data[n]!==t[i].value&&(s.AppConfig.data[n]=t[i].value,a=!0);else if("number"==typeof s.AppConfig.data[n]||s.AppConfig.data[n]instanceof Number){const e=Number(t[i].value);if(null==e)continue;s.AppConfig.data[n]!==e&&(s.AppConfig.data[n]=e,a=!0)}else"boolean"==typeof s.AppConfig.data[n]||s.AppConfig.data[n]instanceof Boolean?"checkbox"===t[i].type?s.AppConfig.data[n]!==t[i].checked&&(s.AppConfig.data[n]=t[i].checked,a=!0):r.default.w("Warning",`config [${n}] matched non-checkbox input (id=${t[i].id})`):r.default.w("Warning",`configToDialog assign failed : [${t[i].id}]`);a&&!this.paneNames.includes(e)&&this.paneNames.push(e)}var h=!1;s.AppConfig.data.setParentheses1(this.paren1.value)&&(h=!0),s.AppConfig.data.setParentheses2(this.paren2.value)&&(h=!0),s.AppConfig.data.setParenthesesShift1(this.parenShift1.value)&&(h=!0),s.AppConfig.data.setParenthesesShift2(this.parenShift2.value)&&(h=!0),h&&!this.paneNames.includes("input")&&this.paneNames.push("input");const d=this.zoomApiKey.value;l.default.useServer()&&l.default.isZoomUrlValid(d)&&(l.default.setZoomUrl(d),this.paneNames.push("zoom"));const u=o.T.matchLocale(s.AppConfig.data.getLocale()),c=this.locales[this.selectLocale.selectedIndex].v1;c!==u&&(s.AppConfig.data.setLocale(c),this.paneNames.push("misc"))}}},534:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.DialogConfigViewer=void 0;const o=i(165),s=i(43),a=i(359),r=n(i(110));e.DialogConfigViewer=class{constructor(){this.container=document.getElementById("config-view-container"),this.pane=document.getElementById("config-view"),this.inputFontSize=document.getElementById("config_main_v_font_size"),this.buttonFontSmaller=document.getElementById("config-view-font-size-down"),this.buttonFontLarger=document.getElementById("config-view-font-size-up"),this.selectLocale=document.getElementById("config-view-select-locale"),this.buttonReset=document.getElementById("config-view-reset"),this.buttonOK=document.getElementById("config-view-button-ok"),this.buttonCancel=document.getElementById("config-view-button-cancel"),this.locales=[],this.paneNames=[],this.doOnSet=t=>{},this.onOpenClicked=()=>{},this.onSaveClicked=()=>{},this.onResetClicked=()=>{},this.setTitle(o.T.t("Config","Config")),this.buttonFontSmaller.addEventListener("click",(t=>{this.inputFontSize.stepDown()})),this.buttonFontLarger.addEventListener("click",(t=>{this.inputFontSize.stepUp()})),this.buttonOK.addEventListener("click",(t=>{this.dialogToConfig(),this.hideDialog(),this.doOnSet(this.paneNames)})),this.buttonCancel.addEventListener("click",(t=>{this.hideDialog()})),this.buttonReset.addEventListener("click",(t=>{this.onResetClicked()}))}getChangedPanes(){return this.paneNames}setOnSet(t){this.doOnSet=e=>t(e)}setTitle(t){}showDialog(){if(this.locales.length<1)for(var t of(this.locales=o.T.getLocales(),this.locales))a.UtilDom.addSelectOption(this.selectLocale,t.v2,t.v1);this.configToDialog(),a.UtilDom.show(this.container)}hideDialog(){a.UtilDom.hide(this.container)}configToDialog(){const t=this.pane.getElementsByTagName("input"),e=t.length;for(var i=0;i<e;i++){const e=t[i];if(!e.id.startsWith("config_"))continue;const o=e.id.substr(7);if(null!=s.AppConfig.data[o])"text"===e.type||"number"===e.type||"color"===e.type?t[i].value=s.AppConfig.data[o].toString():"checkbox"===e.type?!0===s.AppConfig.data[o]?t[i].checked=!0:!1===s.AppConfig.data[o]?t[i].checked=!1:r.default.w("Warning",`configToDialog checkbox item --- not boolean [${e.id}]`):r.default.w("Warning",`configToDialog type not found id:${o}`);else if(null!=s.AppConfig.data[e.name]){const o=s.AppConfig.data[e.name];if("radio"===e.type){var n=!1;switch(typeof o){case"string":n=o===e.value;break;case"number":n=o===Number(e.value);break;case"boolean":n=o===("true"===e.value.toLowerCase())}n&&(t[i].checked=!0)}else r.default.w("Warning",`configToDialog type not found name:${e.name} (id:${e.id})`)}else r.default.w("Warning",`configToDialog assign failed id:${e.id} name:${e.name}`)}var a=0;const l=o.T.matchLocale(s.AppConfig.data.getLocale());for(var h=0;h<this.locales.length;h++)if(this.locales[h].v1===l){a=h;break}this.selectLocale.selectedIndex=a}dialogToConfig(){const t=this.pane.getElementsByTagName("input"),e=t.length;this.paneNames=[];for(var i=0;i<e;i++){if(!t[i].id.startsWith("config_"))continue;var n="";if("radio"===t[i].type){if(!t[i].checked)continue;n=t[i].name}else n=t[i].id.substr(7);if(""!==n&&void 0===s.AppConfig.data[n]){r.default.w("Warning",`dialogToConfig not found : key=${n} element:${t[i].id}`);continue}const e=n.substring(0,n.indexOf("_"));var a=!1;if("string"==typeof s.AppConfig.data[n]||s.AppConfig.data[n]instanceof String)s.AppConfig.data[n]!==t[i].value&&(s.AppConfig.data[n]=t[i].value,a=!0);else if("number"==typeof s.AppConfig.data[n]||s.AppConfig.data[n]instanceof Number){const e=Number(t[i].value);if(null==e)continue;s.AppConfig.data[n]!==e&&(s.AppConfig.data[n]=e,a=!0)}else"boolean"==typeof s.AppConfig.data[n]||s.AppConfig.data[n]instanceof Boolean?"checkbox"===t[i].type?s.AppConfig.data[n]!==t[i].checked&&(s.AppConfig.data[n]=t[i].checked,a=!0):r.default.w("Warning",`config [${n}] matched non-checkbox input (id=${t[i].id})`):r.default.w("Warning",`configToDialog assign failed : [${t[i].id}]`);a&&!this.paneNames.includes(e)&&this.paneNames.push(e)}const l=o.T.matchLocale(s.AppConfig.data.getLocale()),h=this.locales[this.selectLocale.selectedIndex].v1;h!==l&&(s.AppConfig.data.setLocale(h),this.paneNames.push("misc"))}}},956:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const n=i(359);e.default=class{constructor(){this.dialog=document.getElementById("inputdialog"),this.label=document.getElementById("inputdialog_label"),this.input=document.getElementById("inputdialog_text"),this.buttonOk=document.getElementById("inputdialog-ok-button"),this.buttonCancel=document.getElementById("inputdialog-cancel-button"),this.onOkClick=t=>{},this.onCancelClick=()=>{},this.buttonOk.addEventListener("click",(t=>{this.hideDialog(),this.onOkClick(this.input.value),this.resetOkCancelEvents()})),this.buttonCancel.addEventListener("click",(t=>{this.hideDialog(),this.onCancelClick(),this.resetOkCancelEvents()}))}resetOkCancelEvents(){this.onOkClick=()=>{},this.onCancelClick=()=>{}}showDialog(t,e=""){this.label.textContent=t,this.input.value=e,n.UtilDom.show(this.dialog),this.input.focus()}hideDialog(){n.UtilDom.hide(this.dialog)}}},222:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(359),s=n(i(487));e.default=class{constructor(){this.dialogLogin=document.getElementById("login"),this.messageRow=document.getElementById("loginTable_messageRow"),this.roomRow=document.getElementById("loginTable_roomRow"),this.nameRow=document.getElementById("loginTable_nameRow"),this.passRow=document.getElementById("loginTable_passRow"),this.messageCell=document.getElementById("login-message"),this.viewerChoice=document.getElementById("loginTable_role0"),this.viewerRadio=document.getElementById("role0"),this.subtitlerChoice=document.getElementById("loginTable_role1"),this.subtitlerRadio=document.getElementById("role1"),this.roomInput=document.getElementById("login-input-room"),this.nameInput=document.getElementById("login-input-name"),this.passInput=document.getElementById("login-input-pass"),this.buttonLogin=document.getElementById("login-button"),this.downloadPane=document.getElementById("loginDialog_log_download_pane"),this.buttonDownloadMain=document.getElementById("loginDialog_main_log_download"),this.buttonDownloadChat=document.getElementById("loginDialog_chat_log_download"),this.loginCondition=!1,this.onLoginClick=t=>{},this.onDownloadMain=()=>{},this.onDownloadChat=()=>{},this.setEvents(),this.updateState()}enableLogin(){this.loginCondition=!0,this.updateState()}disableLogin(){this.loginCondition=!1,this.updateState()}setEvents(){this.buttonLogin.addEventListener("click",(t=>{const e=new s.default;e.room=this.roomInput.value,e.memberType=this.subtitlerRadio.checked?"wi":"wv",e.name=this.nameInput.value,e.pass=this.passInput.value,this.hideDialog(),this.onLoginClick(e)})),this.buttonDownloadMain.addEventListener("click",(t=>{this.onDownloadMain()})),this.buttonDownloadChat.addEventListener("click",(t=>{this.onDownloadChat()})),this.viewerRadio.addEventListener("change",(t=>{this.updateState(),this.focusMe()})),this.subtitlerRadio.addEventListener("change",(t=>{this.updateState(),this.focusMe()})),this.dialogLogin.addEventListener("change",(t=>{this.updateState()})),this.dialogLogin.addEventListener("input",(t=>{this.updateState()})),this.dialogLogin.addEventListener("paste",(t=>{this.updateState()}))}updateState(){!1===o.UtilDom.isDisplayed(this.roomRow)&&!1===o.UtilDom.isDisplayed(this.nameRow)&&!1===o.UtilDom.isDisplayed(this.passRow)&&(this.buttonLogin.disabled=!1);var t=!0;o.UtilDom.isDisplayed(this.roomRow)&&(this.roomInput.value.length<1&&(t=!1),this.roomInput.validationMessage.length>0&&(t=!1)),o.UtilDom.isDisplayed(this.nameRow)&&this.nameInput.value.length<1&&(t=!1),!0!==this.loginCondition&&(t=!1),this.buttonLogin.disabled=!t}setRoom(t){this.roomInput.value=t}setName(t){this.nameInput.value=t}showDialogWithMessage(t,e=!1,i=!1){this.showMessage(t),this.doShowDialog(e,i)}showDialog(t=!1,e=!1){this.hideMessage(),this.doShowDialog(t,e)}doShowDialog(t=!1,e=!1){!0===t?o.UtilDom.displayOn(this.buttonDownloadMain):o.UtilDom.displayOff(this.buttonDownloadMain),!0===e?o.UtilDom.displayOn(this.buttonDownloadChat):o.UtilDom.displayOff(this.buttonDownloadChat),o.UtilDom.show(this.dialogLogin),this.updateState(),this.focusMe()}isShown(){return o.UtilDom.isShown(this.dialogLogin)}focusMe(){const t=o.UtilDom.isDisplayed(this.roomRow),e=o.UtilDom.isDisplayed(this.nameRow);t?this.roomInput.focus():e?this.nameInput.focus():this.buttonLogin.focus()}hideDialog(){o.UtilDom.hide(this.dialogLogin)}showRoom(){this.roomInput.required=!0,o.UtilDom.displayOn(this.roomRow,"table-row")}fixRoleAsViewer(){this.viewerRadio.checked=!0,o.UtilDom.displayOff(this.subtitlerChoice)}fixRoleAsSubtitler(){this.subtitlerRadio.checked=!0,o.UtilDom.displayOff(this.viewerChoice)}clearRole(){o.UtilDom.displayOn(this.viewerChoice,"inline-block"),o.UtilDom.displayOn(this.subtitlerChoice,"inline-block")}hideRoom(){this.roomInput.required=!1,o.UtilDom.displayOff(this.roomRow)}showName(){this.nameInput.required=!0,o.UtilDom.displayOn(this.nameRow,"table-row")}hideName(){this.nameInput.required=!1,o.UtilDom.displayOff(this.nameRow)}showPass(){this.passInput.required=!0,o.UtilDom.displayOn(this.passRow,"table-row")}hidePass(){this.passInput.required=!1,o.UtilDom.displayOff(this.passRow)}showMessage(t){this.messageCell.textContent=t,o.UtilDom.displayOn(this.messageRow,"table-row")}hideMessage(){this.messageCell.textContent="",o.UtilDom.displayOff(this.messageRow)}}},263:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const n=i(359);e.default=class{constructor(){this.dialog=document.getElementById("notify"),this.title=document.getElementById("notify-title"),this.message=document.getElementById("notify-message"),this.buttonPane=document.getElementById("notify-buttons"),this.okButton=document.getElementById("notify-ok-button"),this.onOkClick=()=>{},this.okButton.addEventListener("click",(()=>{this.hideDialog(),this.onOkClick(),this.resetOkEvents()}))}resetOkEvents(){this.onOkClick=()=>{}}showDialog(t,e,i=!0){this.title.textContent=t,this.message.textContent=e,!0===i?n.UtilDom.show(this.buttonPane):n.UtilDom.hide(this.buttonPane),n.UtilDom.show(this.dialog)}hideDialog(){n.UtilDom.hide(this.dialog)}}},580:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Downloader=void 0;const n=i(43),o=i(527);class s{constructor(){}static start(t,e){this.dlLink.download=t,this.dlLink.href=URL.createObjectURL(new Blob([e],{type:"text/plain"})),this.dlLink.click()}}e.Downloader=s,s.dlLink=document.getElementById("file-download"),e.default=class{constructor(t){this.onAbort=(t,e)=>{},this.onError=(t,e)=>{},this.onLoad=(t,e,i)=>{},this.opener=document.getElementById(t),this.opener.onchange=t=>{var e;if(1===(null===(e=this.opener.files)||void 0===e?void 0:e.length)){const t=new FileReader,e=this.opener.files[0];t.onabort=t=>{this.onAbort(t,e)},t.onerror=t=>{this.onError(t,e)},t.onload=t=>{var i;const s=null===(i=t.target)||void 0===i?void 0:i.result;if(s instanceof ArrayBuffer){let i=o.DetectEncoding.detect(s);i.length<1&&(i=n.AppConfig.data.pft_fallbackEncoding);const a=new TextDecoder(i).decode(s);this.onLoad(t,e,a)}},t.readAsArrayBuffer(e)}}}openDialogAndReadFile(t){null!=t&&(this.opener.accept=t),this.opener.click()}}},607:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(i(752));document.addEventListener("DOMContentLoaded",(()=>{new o.default}))},110:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const n=i(882);e.default=class{static w(t,e){const i=n.Util.getNowUTCTimeString();console.log(`${i} [${t}] ${e}`)}}},487:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.room="",this.name="",this.memberType="",this.pass=""}static clone(t){const e=new i;return e.room=t.room,e.name=t.name,e.memberType=t.memberType,e.pass=t.pass,e}}e.default=i},808:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MekikuUnitDataForEstimate=e.MekikuUnitDataClass=e.MekikuUnitDataFlags=void 0;const n=i(144);var o;(o=e.MekikuUnitDataFlags||(e.MekikuUnitDataFlags={}))[o.NORMAL=0]="NORMAL",o[o.UNDONE=1]="UNDONE";class s{constructor(){this.id="",this.name="",this.receivedMsec=0,this.sentMsec=0,this.memberType=n.MemberType.WEB_SUBTITLER,this.contentType="",this.flag=0,this.content=""}static fromContent(t){const e=new s;return e.id=t.senderID,e.name=t.senderName,e.sentMsec=t.sendTimeCount,e.receivedMsec=t.receiveTimeCount,e.memberType=t.memberType,e}}e.MekikuUnitDataClass=s,e.MekikuUnitDataForEstimate=class{constructor(t){this.lines=[],this.id=t.id,this.name=t.name,this.receivedMsec=t.receivedMsec,this.sentMsec=t.sentMsec,this.memberType=t.memberType,this.contentType=t.contentType,this.sentTimeOriginal=t.sentTimeOriginal,this.flag=t.flag,this.content=t.content,this.estimatedRecvMsec=this.receivedMsec,this.sentTimeAnyway=void 0===this.sentTimeOriginal?this.sentMsec:this.sentTimeOriginal}}},65:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MekikuCommEvents=void 0;const o=n(i(110)),s=i(144),a=n(i(487)),r=i(882),l=n(i(326));e.MekikuCommEvents=class{constructor(){this.onPeerIdAcquired=t=>{},this.onPeerError=t=>{},this.onReceived=t=>{},this.onJoinedRoom=()=>{},this.onLeftRoom=()=>{},this.onSomeoneJoined=t=>{},this.onSomeoneLeft=t=>{},this.logger=t=>{}}};class h{constructor(){this.debugLevel=2,this.handleOpen=t=>{}}}e.default=class{constructor(t){this.onPeerIdAcquired=t=>{},this.onPeerError=t=>{},this.onReceived=t=>{},this.onJoinedRoom=()=>{},this.onLeftRoom=()=>{},this.onSomeoneJoined=t=>{},this.onSomeoneLeft=t=>{},this.logger=t=>{},null!=t&&(this.onPeerIdAcquired=t.onPeerIdAcquired,this.onPeerError=t.onPeerError,this.onJoinedRoom=t.onJoinedRoom,this.onLeftRoom=t.onLeftRoom,this.onReceived=t.onReceived,this.onSomeoneJoined=t.onSomeoneJoined,this.onSomeoneLeft=t.onSomeoneLeft,this.logger=t.logger)}isOpen(){var t;return!0===(null===(t=this.peer)||void 0===t?void 0:t.open)}getInfo(){return null==this.info?void 0:a.default.clone(this.info)}isInRoom(){return null!=this.info}open(t,e){var i;!0===(null===(i=this.peer)||void 0===i?void 0:i.open)&&this.peer.disconnect(),this.openOption={...new h,...e};const n={key:t,debug:this.openOption.debugLevel};if(null!=this.openOption.id&&null!=this.openOption.credential){const t={...n,credential:this.openOption.credential};this.peer=new Peer(this.openOption.id,t)}else this.peer=new Peer(n);this.setPeerEvents(this.peer)}async joinRoom(t,e="sfu"){if(null==this.peer)throw o.default.w("Error","peer is null."),new Error("peer is null");if(!r.Util.isRoomNameLegit(t.room))throw o.default.w("Error",`Illegal room name:[${t.room}]`),new Error("Illegal room name");let i="";switch(l.default.getAuthType()){case"none":i=t.room;break;case"browser":i=await this.makeRoomName(t.room,t.pass);break;case"server":i=t.room;break;default:throw new Error("Impossible authentication type!")}const n=this.peer.joinRoom(i,{mode:e});if(null==n)throw o.default.w("Error","joinRoom failed."),new Error("joinRoom failed.");this.info=a.default.clone(t),this.room=n,this.setRoomEvents(this.room)}async makeRoomName(t,e){return""===e?t:t+"*"+await r.Util.digestMessage(e)}leaveRoom(){null!=this.room&&this.room.close()}queue_room(t){var e,i,n,o;const a=null!==(i=null===(e=this.info)||void 0===e?void 0:e.name)&&void 0!==i?i:"",r=null!==(o=null===(n=this.info)||void 0===n?void 0:n.memberType)&&void 0!==o?o:s.MemberType.WEB_SUBTITLER,l={...t,...new s.ContentToSendClass(a,r)};return null!=this.room&&this.room.send(l),l}send_room(t){var e,i,n,o,a;const r=null!==(i=null===(e=this.info)||void 0===e?void 0:e.name)&&void 0!==i?i:"",l=null!==(o=null===(n=this.info)||void 0===n?void 0:n.memberType)&&void 0!==o?o:s.MemberType.WEB_SUBTITLER,h={...t,...new s.ContentToSendClass(r,l)};return null!=this.room&&(null===(a=this.room)||void 0===a||a.send(h)),h}setPeerEvents(t){t.on("open",(t=>{var e;null!=(null===(e=this.openOption)||void 0===e?void 0:e.handleOpen)&&(this.openOption.handleOpen(t),delete this.openOption),this.onPeerIdAcquired(t)})),t.on("close",(()=>{})),t.on("connection",(t=>{})),t.on("disconnected",(t=>{})),t.on("error",(t=>{o.default.w("Error",`peer error (${t.type}) <${t.message}>`),this.onPeerError(t)}))}setRoomEvents(t){t.on("open",(()=>{this.onJoinedRoom()})),t.on("peerJoin",(t=>{this.onSomeoneJoined(t)})),t.on("peerLeave",(t=>{this.onSomeoneLeft(t)})),t.on("data",(({src:t,data:e})=>{Date.now();const i=s.ContentClass.fromAny(t,e);null!=i&&this.onReceived(i)})),t.on("close",(()=>{var t;delete this.room,delete this.info,null===(t=this.peer)||void 0===t||t.disconnect(),this.onLeftRoom()}))}}},877:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MemberInfoClass=void 0;class i{constructor(t,e){this.id=t,this.memberType=e,this.lastReceived=Date.now(),this.lastSequence=0}static fromContent(t){const e=new i(t.senderID,t.memberType);return e.name=t.senderName,e.lastReceived=t.sendTimeCount,e.lastSequence=t.seqCount,e}}e.MemberInfoClass=i},293:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PaneChat=void 0;const n=i(43),o=i(882),s=i(165),a=i(359),r=i(144);e.PaneChat=class{constructor(){this.pane=document.getElementById("chat"),this.titlebar=document.getElementById("chat-title"),this.logArea=document.getElementById("chat-log"),this.inputArea=document.getElementById("chat-input"),this.buttonStart=document.getElementById("chat-timer-start"),this.buttonPause=document.getElementById("chat-timer-pause"),this.buttonResetTimer=document.getElementById("chat-timer-reset"),this.textTimerNow=document.getElementById("chat-timer-now"),this.buttonUp=document.getElementById("chat-timer-up"),this.buttonDown=document.getElementById("chat-timer-down"),this.textTimerValue=document.getElementById("chat-timer-value"),this.memoText=document.getElementById("chat-memo"),this.memoLabel=document.getElementById("chat-memo-label"),this.audioNextTuen=document.getElementById("audio-nextturn"),this.audioPrecaution=document.getElementById("audio-precaution"),this.countDownTimerId=-1,this.countDown=0,this.countDownFrom=0,this.T_COUNTDOWN=1e3,this.notifyTimerId=-1,this.T_NOTIFY=500,this.T_PRECAUTION=30,this.isOnShow=!1,this.doOnSend=t=>{},this.doOnSendSystem=(t,e)=>{},this.getFkey=t=>"",this.localize(),this.inputArea.addEventListener("keydown",(t=>{t.keyCode===a.UtilDom.KEY_ENTER?(this.onSend(this.inputArea.value),this.inputArea.value=""):t.keyCode===a.UtilDom.KEY_ESC&&(this.inputArea.value="");const e=a.UtilDom.getCtrlOrFKeyNumber(t)-1;if(e>=0&&e<7){const t=this.getFkey(e);t.length>0&&this.insertText(t)}})),this.buttonPause.disabled=!0,this.configToScreen(),this.setEventListeners()}getName(){return"PaneChat"}addMessage(t,e){this.logArea.value+=t+s.T.t(" : ","Chat")+e+"\n",this.logArea.scrollTop=this.logArea.scrollHeight,this.beginNotify()}addChatSystemMessage(t,e,i){let o="";if(e===r.ChatSystemType.NOW)o=this.makeTimerNextTurnMessage(),n.AppConfig.data.chat_useSound&&this.audioNextTuen.play();else if(e===r.ChatSystemType.START)o=this.makeTimerStartMessage(i);else{if(e!==r.ChatSystemType.PRECAUTION)return;o=this.makeTimerPrecautionMessage(),n.AppConfig.data.chat_useSound&&this.audioPrecaution.play()}this.logArea.value+=t+s.T.t(" : ","Chat")+o+"\n",this.logArea.scrollTop=this.logArea.scrollHeight,this.beginNotify()}addSystemMessage(t){const e=(new Date).toLocaleTimeString();this.logArea.value+=t+" ("+e+")\n",this.logArea.scrollTop=this.logArea.scrollHeight,this.beginNotify()}hasLog(){return this.logArea.value.length>0}getLog(){return this.logArea.value}setOnSend(t){this.doOnSend=e=>t(e)}onSend(t){this.doOnSend(t)}setOnSendSystem(t){this.doOnSendSystem=(e,i)=>t(e,i)}setGetFkey(t){this.getFkey=e=>t(e)}setEventListeners(){this.buttonUp.addEventListener("click",(t=>{const e=this.timerText2Config()+1;this.isTimerPeriodValid(e)&&(this.setTimerPeriod(e),this.timerConfig2Text())})),this.buttonDown.addEventListener("click",(t=>{const e=this.timerText2Config()-1;this.isTimerPeriodValid(e)&&(this.setTimerPeriod(e),this.timerConfig2Text())})),this.textTimerValue.addEventListener("change",(t=>{this.timerText2Config()})),this.buttonStart.addEventListener("click",(t=>{this.startCountDown()})),this.buttonPause.addEventListener("click",(t=>{this.stopCountDown()})),this.buttonResetTimer.addEventListener("click",(t=>{this.resetCountDown()}))}insertText(t){if(null==this.inputArea.selectionStart)return;var e=this.inputArea.selectionStart,i=this.inputArea.selectionStart;this.inputArea.selectionEnd&&(e=Math.min(this.inputArea.selectionStart,this.inputArea.selectionEnd),i=Math.max(this.inputArea.selectionStart,this.inputArea.selectionEnd));const n=this.inputArea.value.substr(0,e),o=this.inputArea.value.substr(i);this.inputArea.value=n+t+o;const s=(n+t).length;this.inputArea.setSelectionRange(s,s)}startCountDown(){this.countDownTimerId>=0||(this.buttonStart.disabled=!0,this.buttonPause.disabled=!1,this.buttonResetTimer.disabled=!0,this.doOnSendSystem(r.ChatSystemType.START,this.getRemainingTimeText()),this.countDownTimerId=window.setInterval((()=>{this.onCount()}),this.T_COUNTDOWN))}makeTimerStartMessage(t){return s.T.t("Timer started. Next ","Chat")+"["+t+"] ("+(new Date).toLocaleTimeString()+")"}makeTimerPrecautionMessage(){return s.T.t("30 seconds to next turn.","Chat")+" ("+(new Date).toLocaleTimeString()+")"}makeTimerNextTurnMessage(){return s.T.t("It's new turn now.","Chat")+" ("+(new Date).toLocaleTimeString()+")"}onCount(){if(this.countDown--,this.updateTimerNow(),this.countDown===this.T_PRECAUTION)this.doOnSendSystem(r.ChatSystemType.PRECAUTION,String(this.T_PRECAUTION));else if(0===this.countDown){this.doOnSendSystem(r.ChatSystemType.NOW,"0");const t=Number(this.textTimerValue.value);!1===isNaN(t)&&this.isTimerPeriodValid(t)&&(this.countDownFrom=60*t),this.countDown=this.countDownFrom}}stopCountDown(){this.countDownTimerId<0||(window.clearInterval(this.countDownTimerId),this.countDownTimerId=-1,this.buttonStart.disabled=!1,this.buttonPause.disabled=!0,this.buttonResetTimer.disabled=!1,this.onSend(s.T.t("Timer halted.","Chat")+" ("+(new Date).toLocaleTimeString()+")"))}resetCountDown(){this.countDownFrom=60*n.AppConfig.data.chat_timer,this.textTimerValue.value=n.AppConfig.data.chat_timer.toString(),this.countDownTimerId<0&&(this.countDown=this.countDownFrom),this.updateTimerNow()}updateTimerNow(){this.textTimerNow.textContent=this.getRemainingTimeText()}getRemainingTimeText(){const t=Math.floor(this.countDown/60),e=this.countDown-60*t;return`${t}:${o.Util.toStringWithZero(e,2)}`}timerText2Config(){const t=Number(this.textTimerValue.value);return isNaN(t)||!0!==this.isTimerPeriodValid(t)?this.timerConfig2Text():this.setTimerPeriod(t),this.getTimerPeriod()}timerConfig2Text(){this.textTimerValue.value=this.getTimerPeriod().toString()}getTimerPeriod(){return n.AppConfig.data.chat_timer}isTimerPeriodValid(t){return t>=1&&t<=99}setTimerPeriod(t){return this.isTimerPeriodValid(t)&&(n.AppConfig.data.chat_timer=t),this.getTimerPeriod()}beginNotify(){this.notifyTimerId>=0&&window.clearTimeout(this.notifyTimerId),this.logArea.style.backgroundColor=n.AppConfig.data.chat_notifyColor,this.notifyTimerId=window.setTimeout((()=>{this.endNotify()}),this.T_NOTIFY)}endNotify(){this.logArea.style.backgroundColor=n.AppConfig.data.chat_backColor,this.notifyTimerId=-1}configToScreen(){this.logArea.style.fontFamily=a.UtilDom.makeFontFamily(n.AppConfig.data.chat_font_familyName),this.logArea.style.fontSize=n.AppConfig.data.chat_font_size+"pt",this.logArea.style.fontWeight=n.AppConfig.data.chat_font_isBold?"bold":"normal",this.logArea.style.color=n.AppConfig.data.chat_foreColor,this.logArea.style.backgroundColor=n.AppConfig.data.chat_backColor,this.memoText.style.fontFamily=a.UtilDom.makeFontFamily(n.AppConfig.data.chat_font_familyName),this.memoText.style.fontSize=n.AppConfig.data.chat_font_size+"pt",this.memoText.style.fontWeight=n.AppConfig.data.chat_font_isBold?"bold":"normal",this.memoText.style.color=n.AppConfig.data.chat_foreColor,this.memoText.style.backgroundColor=n.AppConfig.data.chat_backColor,this.memoLabel.style.fontFamily=a.UtilDom.makeFontFamily(n.AppConfig.data.chat_font_familyName),this.memoLabel.style.fontSize=7*n.AppConfig.data.chat_font_size/10+"pt",this.memoLabel.style.color=n.AppConfig.data.chat_foreColor,this.memoLabel.style.backgroundColor=n.AppConfig.data.chat_backColor,this.inputArea.style.fontFamily=a.UtilDom.makeFontFamily(n.AppConfig.data.chat_font_familyName),this.inputArea.style.fontSize=n.AppConfig.data.chat_font_size+"pt",this.inputArea.style.fontWeight=n.AppConfig.data.chat_font_isBold?"bold":"normal";var t=n.AppConfig.data.chat_foreColor,e=n.AppConfig.data.chat_backColor;this.inputArea.style.color=t,this.inputArea.style.backgroundColor=e,this.resetCountDown()}updateConfig(){this.configToScreen()}setPaneToConfig(){}localize(){this.setTitle(s.T.t("Chat","Chat")+o.Util.getShortcutParenthesized("R"))}setTitle(t){this.titlebar.textContent=t}focus(){this.inputArea.focus()}toggle(){a.UtilDom.isDisplayed(this.pane)?this.hide():this.show()}show(){a.UtilDom.displayOn(this.pane,"flex")}hide(){a.UtilDom.displayOff(this.pane)}}},239:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PaneContainer3=e.PaneContainer2=e.PaneContainer1=void 0;const n=i(359);e.PaneContainer1=class{constructor(){this.pane=document.getElementById("pane1")}setDefault(){this.pane.style.width="45%"}setFullWidth(){this.pane.style.width="100%"}},e.PaneContainer2=class{constructor(){this.pane=document.getElementById("pane2")}show(){n.UtilDom.displayOn(this.pane,"flex")}hide(){n.UtilDom.displayOff(this.pane)}},e.PaneContainer3=class{constructor(){this.pane=document.getElementById("pane3")}show(){n.UtilDom.displayOn(this.pane,"flex")}hide(){n.UtilDom.displayOff(this.pane)}}},771:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PaneFkey=void 0;const n=i(43),o=i(882),s=i(165),a=i(359);e.PaneFkey=class{constructor(){this.pane=document.getElementById("fkey"),this.titlebar=document.getElementById("fkey-title"),this.outerTable=document.getElementById("fkey-table"),this.localize(),this.fkeys=[document.getElementById("fkey01"),document.getElementById("fkey02"),document.getElementById("fkey03"),document.getElementById("fkey04"),document.getElementById("fkey05"),document.getElementById("fkey06"),document.getElementById("fkey07"),null,null],this.configToScreen()}getName(){return"PaneFkey"}applyFont(t){t.style.fontFamily=a.UtilDom.makeFontFamily(n.AppConfig.data.fkey_font_familyName),t.style.fontSize=n.AppConfig.data.fkey_font_size+"pt",t.style.fontWeight=n.AppConfig.data.fkey_font_isBold?"bold":"normal"}applyColor(t){var e=n.AppConfig.data.fkey_foreColor,i=n.AppConfig.data.fkey_backColor;t.style.color=e,t.style.backgroundColor=i}configToScreen(){const t=this.outerTable.getElementsByClassName("fkey-label");for(var e of t){const t=document.getElementById(e.id);null!==t&&this.applyFont(t)}const i=this.outerTable.getElementsByClassName("fkey-input");for(var n of i){const t=document.getElementById(n.id);null!==t&&(this.applyFont(t),this.applyColor(t))}const o=this.outerTable.getElementsByClassName("fkey-text-readonly");for(var s of o){const t=document.getElementById(s.id);null!==t&&this.applyFont(t)}}getFKey(t){if(t>=0&&t<this.fkeys.length){const e=this.fkeys[t];if(null!=e)return e.value}return""}localize(){this.setTitle(s.T.t("Shortcut","Fkey")+o.Util.getShortcutParenthesized("F"))}setTitle(t){this.titlebar.textContent=t}updateConfig(){this.configToScreen()}setPaneToConfig(){}focus(){var t;null===(t=this.fkeys[0])||void 0===t||t.focus()}toggle(){a.UtilDom.isDisplayed(this.pane)?this.hide():this.show()}show(){a.UtilDom.displayOn(this.pane)}hide(){a.UtilDom.displayOff(this.pane)}}},150:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PaneInput=void 0;const n=i(43),o=i(359),s=i(165),a=i(882);e.PaneInput=class{constructor(){this.pane=document.getElementById("input"),this.titlebar=document.getElementById("input-title"),this.input1Vjs=document.getElementById("input1"),this.input2Vjs=document.getElementById("input2"),this.lastInput=0,this.isOnShow=!1,this.getFkey=t=>"",this.doOnInput=t=>{},this.lastSendInput="",this.doOnEnter=t=>{},this.doOnUndo=()=>"",this.doOnErase=()=>{},this.localize(),this.input1Vjs.addEventListener("focus",(t=>{this.lastInput=0})),this.input2Vjs.addEventListener("focus",(t=>{this.lastInput=1})),this.input1Vjs.addEventListener("input",(t=>{this.onInput(this.input1Vjs.value)})),this.input2Vjs.addEventListener("input",(t=>{this.onInput(this.input2Vjs.value)})),this.input1Vjs.addEventListener("keydown",(t=>{this.onType(this.input1Vjs,t,this.input2Vjs)})),this.input2Vjs.addEventListener("keydown",(t=>{this.onType(this.input2Vjs,t,this.input1Vjs)})),this.configToScreen()}getName(){return"PaneInput"}getLastInput(){return 1!==this.lastInput?this.input1Vjs.value:this.input2Vjs.value}setGetFkey(t){this.getFkey=e=>t(e)}setDoOnInput(t){this.doOnInput=e=>t(e)}onInput(t){t!==this.lastSendInput&&(this.lastSendInput=t,this.doOnInput(t))}setDoOnEnter(t){this.doOnEnter=e=>t(e)}onEnter(t){this.doOnEnter(t)}setDoOnUndo(t){this.doOnUndo=()=>t()}onUndo(){return this.doOnUndo()}setDoOnErase(t){this.doOnErase=()=>t()}onErase(){this.doOnErase()}onType(t,e,i){if(e.keyCode!==o.UtilDom.KEY_CTRL){if(e.keyCode===o.UtilDom.KEY_TAB)i.focus(),e.preventDefault(),e.stopImmediatePropagation();else if(e.keyCode===o.UtilDom.KEY_ENTER)this.onEnter(t.value),t.value="",e.preventDefault(),e.stopImmediatePropagation();else if(e.keyCode===o.UtilDom.KEY_ESC)t.value="",e.preventDefault(),e.stopImmediatePropagation();else{const i=o.UtilDom.getCtrlOrFKeyNumber(e)-1;if(i>=0&&i<7){const n=this.getFkey(i);n.length>0&&this.replacePart(t,n),e.preventDefault(),e.stopImmediatePropagation()}else if(7===i)!0!==e.shiftKey?this.enclose(t,n.AppConfig.data.getParentheses1(),n.AppConfig.data.getParentheses2()):this.enclose(t,n.AppConfig.data.getParenthesesShift1(),n.AppConfig.data.getParenthesesShift2()),e.preventDefault(),e.stopImmediatePropagation();else if(8===i){const i=this.onUndo();i.length>0&&this.insertTop(t,i),e.preventDefault(),e.stopImmediatePropagation()}}this.onInput(t.value)}}applyStyle(t){t.style.fontFamily=o.UtilDom.makeFontFamily(n.AppConfig.data.input_font_familyName),t.style.fontSize=n.AppConfig.data.input_font_size+"pt",t.style.fontWeight=n.AppConfig.data.input_font_isBold?"bold":"normal";var e=n.AppConfig.data.input_foreColor,i=n.AppConfig.data.input_backColor;t.style.color=e,t.style.backgroundColor=i}configToScreen(){this.applyStyle(this.input1Vjs),this.applyStyle(this.input2Vjs)}setPaneToConfig(){}insertTop(t,e){const i=t.selectionEnd||0;t.value=e+t.value;const n=i+e.length;t.blur(),t.setSelectionRange(n,n),t.focus()}replacePart(t,e){const i=t.selectionStart||0,n=t.selectionEnd||0,o=t.value.substring(0,i),s=t.value.substring(n);t.value=o+e+s;const a=i+e.length;t.blur(),t.setSelectionRange(a,a),t.focus()}enclose(t,e,i){const n=t.selectionStart||0,o=t.selectionEnd||0,s=t.value.length;t.value=e+t.value+i;var a=n+e.length,r=o+e.length;n===o&&o===s&&(a+=i.length,r+=i.length),t.blur(),t.setSelectionRange(a,r),t.focus()}updateConfig(){this.configToScreen()}focus(){1===this.lastInput?this.input2Vjs.focus():this.input1Vjs.focus()}localize(){this.setTitle(s.T.t("Input Window","Input")+a.Util.getShortcutParenthesized("I"))}setTitle(t){this.titlebar.textContent=t}toggle(){o.UtilDom.isDisplayed(this.pane)?this.hide():this.show()}show(){o.UtilDom.displayOn(this.pane,"flex")}hide(){o.UtilDom.displayOff(this.pane)}}},900:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PaneMain=void 0;const o=i(43),s=i(174),a=i(144),r=i(359),l=n(i(110)),h=i(808);class d{constructor(){this.pane=document.getElementById("display"),this.mainText=document.getElementById("mainText"),this.lineHeightChecker=document.getElementById("mainLineHeightChecker"),this.mainCache=document.getElementById("mainCache"),this.lineHeight=0,this.linesDisplayed=6,this.delimiter="",this.contents=new s.ContentManager,this.newItems=new Array,this.undoQueue=new Array,this.isViewerMode=!1;const t={pane:this.pane,mainText:this.mainText,lineHeightChecker:this.lineHeightChecker};this.scrollManager=new u(t),this.scrollManager.setOnScroll((()=>{this.contents.proceedLine(),this.restructureMainText(),!1===document.hidden?this.scrollManager.startScrollIfNeeded():this.stopScrollAndJumpToLatest()})),this.configToScreen()}getName(){return"PaneMain"}onScrollCancelForRestructure(){this.updateScreenParameters(),this.contents.loopItemsFromTop((t=>this.addMeasureItems(t))),this.restructureMainText(),this.scrollManager.startScrollIfNeeded()}getMainLog(){return this.contents.getLog()}hasMainLog(){return this.contents.hasLog()}addNewItem(t){const e=this.undoIfQueued(t),i=h.MekikuUnitDataClass.fromContent(t);i.contentType=a.ContentType.DISPLAY,i.id=t.senderID,i.content=t.D,e&&(i.flag|=h.MekikuUnitDataFlags.UNDONE),this.contents.addLog(i),e||(this.contents.loopItems((t=>this.addMeasureItems(t))),this.restructureMainText(),this.contents.notifyPacketEnd(),!1===document.hidden?this.scrollManager.startScrollIfNeeded():this.stopScrollAndJumpToLatest())}addNewGross(t){const e=h.MekikuUnitDataClass.fromContent(t);e.contentType=a.ContentType.GROSS,e.id=t.senderID,e.content=t.G,this.contents.addLog(e),this.contents.loopItems((t=>this.addMeasureItems(t))),this.restructureMainText(),this.stopScrollAndJumpToLatest()}undoLastItem(){const t=this.contents.undoLastItem();return null==t?null:(this.contents.loopItems((t=>this.addMeasureItems(t))),this.restructureMainText(),this.contents.notifyPacketEnd(),!1===document.hidden?this.scrollManager.startScrollIfNeeded():this.stopScrollAndJumpToLatest(),t)}undoIfQueued(t){const e=this.undoQueue.findIndex((e=>t.senderID===e.U_ID&&t.sendTimeCount===e.U_SENDTIME));return!(e<0||(this.undoQueue.splice(e,1),0))}addNewUndo(t){const e=this.contents.undoItem(t.U_ID,t.U_SENDTIME);null!=e?!1!==e&&(this.contents.loopItems((t=>this.addMeasureItems(t))),this.restructureMainText(),this.contents.notifyPacketEnd(),!1===document.hidden?this.scrollManager.startScrollIfNeeded():this.stopScrollAndJumpToLatest()):this.undoQueue.push(t)}addNewErase(t){const e=h.MekikuUnitDataClass.fromContent(t);e.contentType=a.ContentType.ERASE,e.content=d.NEW_LINE.repeat(this.linesDisplayed+1),this.contents.addLog(e),this.contents.loopItems((t=>this.addMeasureItems(t))),this.restructureMainText(),this.stopScrollAndJumpToLatest()}notifyNewItem(t){t.contentType===a.ContentType.ERASE&&(t.content=d.NEW_LINE.repeat(this.linesDisplayed+1)),this.newItems.push(t)}notifyNewItemsFinish(){if(this.newItems.length<1)return;for(const t of this.newItems)this.contents.updateLog(t);const t=this.contents.getUpdateFlags();t!==s.MainUpdateFlags.NOP&&(this.newItems=new Array,this.contents.loopItems((t=>this.addMeasureItems(t))),t&(s.MainUpdateFlags.ERASE|s.MainUpdateFlags.GROSS)?this.stopScrollAndJumpToLatest():(this.restructureMainText(),this.contents.notifyPacketEnd(),!1===document.hidden?this.scrollManager.startScrollIfNeeded():this.stopScrollAndJumpToLatest()))}restructureMainText(){const t=this.contents.getDisplayLog(),e=this.joinAndCountLines(t);return this.mainText.textContent=this.makeText(e.v1),e.v2}jumpToLatest(){let t=this.contents.getDisplayLog(),e=this.joinAndCountLines(t);e.v2>this.linesDisplayed&&(this.contents.proceedLine(e.v2-this.linesDisplayed),t=this.contents.getDisplayLog(),e=this.joinAndCountLines(t)),this.mainText.textContent=this.makeText(e.v1)}stopScrollAndJumpToLatest(){this.scrollManager.cancelScroll((()=>{this.jumpToLatest(),this.contents.notifyPacketEnd()}))}joinAndCountLines(t){return{v1:t.join(d.NEW_LINE),v2:t.length}}makeText(t){return t.endsWith("\n")?t+d.NBSP:t}addMeasureItems(t){return this.divideTextIntoDisplayLines(t.content)}divideTextIntoDisplayLines(t){const e=t.split(d.NEW_LINE);var i=new Array;for(var n of e){let t=this.divideLineIntoDisplayLines(n);i.push(...t)}return i}divideLineIntoDisplayLines(t){const e=t.length;for(var i=0,n=e,o=i,s=n,a=new Array,r=0;;r++){this.mainCache.textContent=t.substring(i,n);const h=this.mainCache.getBoundingClientRect();if(Math.round(h.height/this.lineHeight)<=1?(o=Math.max(n,o),n=Math.ceil((o+s)/2)):(s=Math.min(n,s),n=Math.floor((o+s)/2)),s-o<=1){if(a.push(t.substring(i,o)),o>=e)break;i=o,n=s=e}if(r>1e4){l.default.w("Error",`divideLineIntoDisplayLines cycle too much! arg:\n${t}`);break}}return a}configToScreen(){this.pane.style.backgroundColor=this.getBackColor(),this.applyFont(this.mainText),this.mainText.style.lineHeight=this.getLineHeight()+"%",this.applyFont(this.lineHeightChecker),this.lineHeightChecker.style.lineHeight=this.getLineHeight()+"%",this.applyFont(this.mainCache);const t=r.UtilDom.extractCSSRulesByText("transition-duration");for(const e of t)e.type===CSSRule.STYLE_RULE&&(e.style.transitionDuration=this.getScrollMsec()+"ms");this.updateScreen()}updateScreen(){this.updateScreenParameters(),this.scrollManager.cancelScroll((()=>{this.contents.loopItemsFromTop((t=>this.addMeasureItems(t))),this.restructureMainText(),this.scrollManager.startScrollIfNeeded()}))}updateScreenParameters(){this.mainCache.style.lineHeight=this.getLineHeight()+"%",this.mainCache.style.width=this.mainText.getBoundingClientRect().width+"px";const t=this.lineHeightChecker.getBoundingClientRect();this.lineHeight=t.height,this.scrollManager.lineHeightPx=this.lineHeight;const e=this.pane.getBoundingClientRect();this.linesDisplayed=Math.floor(e.height/this.lineHeight),this.scrollManager.linesDisplayed=this.linesDisplayed}applyFont(t){t.style.fontFamily=r.UtilDom.makeFontFamily(this.getFontFamily()),t.style.fontSize=this.getFontSize()+"pt",t.style.fontWeight=this.isBold()?"bold":"normal",t.style.color=this.getForeColor(),t.style.backgroundColor=this.getBackColor()}getFontFamily(){return this.isViewerMode?o.AppConfig.data.main_v_font_familyName:o.AppConfig.data.main_font_familyName}getFontSize(){return this.isViewerMode?o.AppConfig.data.main_v_font_size:o.AppConfig.data.main_font_size}isBold(){return this.isViewerMode?o.AppConfig.data.main_v_font_isBold:o.AppConfig.data.main_font_isBold}getForeColor(){return this.isViewerMode?o.AppConfig.data.main_v_foreColor:o.AppConfig.data.main_foreColor}getBackColor(){return this.isViewerMode?o.AppConfig.data.main_v_backColor:o.AppConfig.data.main_backColor}getLineHeight(){return this.isViewerMode?o.AppConfig.data.main_v_lineHeight:o.AppConfig.data.main_lineHeight}getScrollMsec(){return this.isViewerMode?o.AppConfig.data.main_v_scrollMsec:o.AppConfig.data.main_scrollMsec}setViewerMode(t){this.isViewerMode=t}updateConfig(){this.configToScreen()}setPaneToConfig(){}focus(){}toggle(){}show(){}hide(){}}e.PaneMain=d,d.NEW_LINE="\n",d.NBSP=String.fromCharCode(160);class u{constructor(t){this.SCROLL_NAME="scroll",this.linesDisplayed=0,this.isScrolling=!1,this.isHalt=!1,this.doOnScroll=()=>{},this.pane=t.pane,this.mainText=t.mainText,this.lineHeightChecker=t.lineHeightChecker;const e=this.lineHeightChecker.getBoundingClientRect();this.lineHeightPx=e.height,this.mainText.addEventListener("transitionend",(()=>this.onScrollEnd()))}setOnScroll(t){this.doOnScroll=()=>t()}onScrollEnd(){this.isScrolling=!1,this.mainText.classList.remove(this.SCROLL_NAME),this.setTop(0),this.doOnScroll()}startScrollIfNeeded(){this.isScrolling||this.isHalt||this.isTextBottomBelowPane()&&(this.isScrolling=!0,this.mainText.classList.add(this.SCROLL_NAME),this.setTop(-this.lineHeightPx))}cancelScroll(t){const e=this.isScrolling;this.isScrolling=!1,this.mainText.classList.remove(this.SCROLL_NAME),e&&this.setTop(-8e3),window.setTimeout((()=>{this.setTop(0),t()}),0)}setTop(t){this.mainText.style.transform=`translate(0px,${t}px)`}moveToTopNow(){this.mainText.classList.remove(this.SCROLL_NAME),this.setTop(0)}isTextBottomBelowPane(){const t=this.pane.getBoundingClientRect();return this.mainText.getBoundingClientRect().bottom>t.bottom}}},702:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PaneMonitor=void 0;const o=i(43),s=i(165),a=i(359),r=i(144),l=n(i(110));e.PaneMonitor=class{constructor(){this.onMemberNewJoined=t=>{},this.onMemberLeft=t=>{},this.members=[],this.viewers=[],this.pane=document.getElementById("monitor"),this.titlebar=document.getElementById("monitor-title"),this.table=document.getElementById("monitorTable"),this.fontChecker=document.getElementById("monitorFontChecker"),this.header1=document.getElementById("monitorHeader1"),this.header2=document.getElementById("monitorHeader2"),this.footer=document.getElementById("monitorFooter"),this.shortState=document.getElementById("short_state"),this.IX_NAME=0,this.IX_INPUT=1,this.N_COLUMNS=2,this.localize(),this.configToScreen(),this.updateFooter(),this.updateShortState()}getName(){return"PaneMonitor"}setOnNewJoined(t){this.onMemberNewJoined=e=>t(e)}setOnLeft(t){this.onMemberLeft=e=>t(e)}updateMember(t,e){if(t.memberType===r.MemberType.WEB_VIEWER)if((i=this.viewers.findIndex((e=>e.id===t.id)))<0)this.viewers.push(t),this.updateFooter(),this.updateShortState(),r.ContentType.LOGIN in e&&this.onMemberNewJoined(t);else{const e=this.viewers.splice(i,1,t);1===e.length&&t.lastSequence!==e[0].lastSequence+1&&l.default.w("Warning",`Viewer [${t.id}](${t.name}) seq jump from ${e[0].lastSequence} to ${t.lastSequence}`)}else{var i;if((i=this.members.findIndex((e=>e.id===t.id)))<0)this.members.push(t),this.addRow(),i=this.members.length-1,this.updateShortState(),r.ContentType.LOGIN in e&&this.onMemberNewJoined(t);else{const e=this.members.splice(i,1,t);1===e.length&&(t.lastSequence!==e[0].lastSequence+1&&l.default.w("Warning",`Member [${t.id}](${t.name}) seq jump from ${e[0].lastSequence} to ${t.lastSequence}`),null==t.inputContent&&null!=e[0].inputContent&&(t.inputContent=e[0].inputContent))}this.updateRow(i,t)}}updateFooter(){const t=this.viewers.length>0?": ":"",e=this.viewers.map((t=>{var e;return null!==(e=t.name)&&void 0!==e?e:"?"})).join(" ");this.footer.textContent=`${s.T.t("Viewer","General")}(${this.viewers.length})${t}${e}`}updateShortState(){this.shortState.textContent=`${s.T.t("Subtitler","General")} : ${this.members.length} , ${s.T.t("Viewer","General")} : ${this.viewers.length+1}`}deleteMember(t){const e=this.members.findIndex((e=>e.id===t));if(e>=0){const t=this.members.splice(e,1);this.removeRow(e+1),t.length>0&&this.onMemberLeft(t[0])}const i=this.viewers.findIndex((e=>e.id===t));if(i>=0){const t=this.viewers.splice(i,1);this.updateFooter(),t.length>0&&this.onMemberLeft(t[0])}this.updateShortState()}clearMembers(){this.members=[],this.viewers=[],this.clearRows(),this.updateFooter(),this.updateShortState()}configToScreen(){this.table.style.fontFamily=a.UtilDom.makeFontFamily(o.AppConfig.data.monitor_font_familyName),this.table.style.fontSize=o.AppConfig.data.monitor_font_size+"pt",this.table.style.fontWeight=o.AppConfig.data.monitor_font_isBold?"bold":"normal",this.table.style.color=o.AppConfig.data.monitor_foreColor,this.table.style.backgroundColor=o.AppConfig.data.monitor_backColor,this.pane.style.backgroundColor=o.AppConfig.data.monitor_backColor,this.fontChecker.style.fontFamily=a.UtilDom.makeFontFamily(o.AppConfig.data.monitor_font_familyName),this.fontChecker.style.fontSize=o.AppConfig.data.monitor_font_size+"pt",this.fontChecker.style.color=o.AppConfig.data.monitor_backColor,this.fontChecker.style.backgroundColor=o.AppConfig.data.monitor_backColor,this.footer.style.fontFamily=a.UtilDom.makeFontFamily(o.AppConfig.data.monitor_font_familyName),this.footer.style.fontSize=o.AppConfig.data.monitor_font_size+"pt",this.footer.style.color=o.AppConfig.data.monitor_foreColor,this.footer.style.backgroundColor=o.AppConfig.data.monitor_backColor}clearRows(){for(;this.table.rows[1];)this.table.deleteRow(1)}addRow(){const t=this.table.insertRow(-1);this.addColumns(t,this.N_COLUMNS)}addColumns(t,e){for(var i=0;i<e;i++){const e=t.insertCell(-1),i=document.createTextNode("");e.appendChild(i)}}removeRow(t){this.table.deleteRow(t)}updateRow(t,e){const i=this.table.rows[t+1],n=i.cells[this.IX_NAME].firstChild,o=null!=e.name?e.name:"noname";n&&(n.data=o),i.cells[this.IX_NAME].title=e.id;const s=i.cells[this.IX_INPUT].firstChild,a=void 0===e.inputContent?"":e.inputContent;if(s){const t=this.seekTextStartForShowAll(a);var r=a.substr(t);s.data=r}this.updateStates()}seekTextStartForShowAll(t){const e=t.length,i=a.UtilDom.getWidth(this.header2);this.fontChecker.textContent=t;var n=a.UtilDom.getWidth(this.fontChecker);if(n<=i)return 0;for(var o=Math.floor(e/2),s=e,r=1,l=0;l<10;l++){if(this.fontChecker.textContent=t.substr(e-o,o),(n=a.UtilDom.getWidth(this.fontChecker))>i?o<s&&(s=o):o>r&&(r=o),s===r+1)return e-r;o=Math.floor((s+r)/2)}return e-r}updateStates(){}updateConfig(){this.configToScreen()}localize(){this.setTitle(s.T.t("Input Monitor","Monitor")),this.updateFooter(),this.updateShortState()}setTitle(t){this.titlebar.textContent=t}focus(){}toggle(){a.UtilDom.isDisplayed(this.pane)?this.hide():this.show()}show(){a.UtilDom.displayOn(this.pane)}hide(){a.UtilDom.displayOff(this.pane)}}},79:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PanePft=void 0;const n=i(43),o=i(882),s=i(165),a=i(359);e.PanePft=class{constructor(){this.MAX_LINES_GROSS=20,this.NEWLINE="\n",this.GROSS_DELIMITER="`@"+this.NEWLINE,this.COMMENT_IDENTIFIER="<-",this.COMMENT_IPTALK_ID="<--",this.paneIdsVjs=["pft1","pft2","pft3"],this.textIdsVjs=["pft1-text","pft2-text","pft3-text"],this.nameIdsVjs=["pft1-name","pft2-name","pft3-name"],this.nameTextIdsVjs=["pft1-name-text","pft2-name-text","pft3-name-text"],this.paths=["","",""],this.encodings=["utf-8","utf-8","utf-8"],this.lastUsed=0,this.fileTarget=-1,this.RESPONSE_KEYS=["Home","End","PageUp","PageDown","Shift"],this.pane=document.getElementById("pft"),this.titlebar=document.getElementById("pft-title"),this.buttonOpenFile=document.getElementById("pft-open-file"),this.buttonSaveFile=document.getElementById("pft-save-file"),this.buttonNextComment=document.getElementById("pft-next-comment"),this.buttonPreviousComment=document.getElementById("pft-previous-comment"),this.buttonNextPft=document.getElementById("pft-next-pft"),this.buttonPreviousPft=document.getElementById("pft-previous-pft"),this.isOnShow=!1,this.getFkey=t=>"",this.doOnSend=t=>{},this.doOnGross=t=>{},this.doOnChange=(t,e)=>{},this.doOnOpenCommand=t=>{},this.doOnSaveCommand=(t,e)=>{},this.localize(),this.panes=new Array,this.texts=new Array,this.names=new Array,this.nameTexts=new Array;for(var t=0;t<this.textIdsVjs.length;t++){const e=document.getElementById(this.paneIdsVjs[t]);this.panes.push(e);const i=document.getElementById(this.nameIdsVjs[t]);this.names.push(i);const n=document.getElementById(this.nameTextIdsVjs[t]);this.nameTexts.push(n);const o=document.getElementById(this.textIdsVjs[t]);this.texts.push(o),o.addEventListener("keydown",(t=>{const e=a.UtilDom.getCtrlOrFKeyNumber(t)-1;if(0===e){if(t.preventDefault(),t.stopImmediatePropagation(),t.shiftKey){const t=this.getGrossLinesAndGoNext(o);this.onGross(t)}else{const t=this.getCurrentLine(o);this.goNextLine(o),t.startsWith("<-")||this.onSend(t)}const e=this.getMonitorLines(o);this.onChange(e.v1,e.v2)}else if(e>0&&e<7){const t=this.getFkey(e);t.length>0&&this.insertText(o,t)}else 7===e&&(t.shiftKey?this.parenthesizeShift(o):this.parenthesize(o));a.UtilDom.isCommandOrControlPressed(t)&&(t.keyCode===a.UtilDom.KEY_ARROW_DOWN?(this.doOnGoNextComment(o),t.preventDefault()):t.keyCode===a.UtilDom.KEY_ARROW_UP?(this.doOnGoPreviousComment(o),t.preventDefault()):t.keyCode===a.UtilDom.KEY_ARROW_LEFT?(this.doOnGoPreviousPft(o),t.preventDefault()):t.keyCode===a.UtilDom.KEY_ARROW_RIGHT?(this.doOnGoNextPft(o),t.preventDefault()):t.keyCode===a.UtilDom.KEY_O?(t.preventDefault(),t.stopImmediatePropagation(),this.onOpenCommand(this.lastUsed)):t.keyCode===a.UtilDom.KEY_S?(t.preventDefault(),t.stopImmediatePropagation(),this.onSaveCommand(this.lastUsed)):t.keyCode===a.UtilDom.KEY_K?(t.preventDefault(),t.stopImmediatePropagation(),this.toggleComment(o)):t.keyCode===a.UtilDom.KEY_P&&(t.preventDefault(),t.stopImmediatePropagation(),this.insertGrossDelimiter(o)))})),o.addEventListener("focus",(t=>{this.lastUsed=parseInt(o.id.replace(/[^0-9]/g,""),10)-1,this.updateAllPftSizes()})),o.addEventListener("input",(t=>{const e=this.getMonitorLines(o);this.onChange(e.v1,e.v2)})),o.addEventListener("keyup",(t=>{if(t.key.includes("Arrow")||this.RESPONSE_KEYS.includes(t.key)){const t=this.getMonitorLines(o);this.onChange(t.v1,t.v2)}}))}this.configToScreen(),this.setEventListeners()}getName(){return"PanePft"}setGetFkey(t){this.getFkey=e=>t(e)}setOnSend(t){this.doOnSend=e=>t(e)}onSend(t){this.doOnSend(t)}setOnGross(t){this.doOnGross=e=>t(e)}onGross(t){this.doOnGross(t)}setOnChange(t){this.doOnChange=(e,i)=>t(e,i)}onChange(t,e){this.doOnChange(t,e)}setOnOpenCommand(t){this.doOnOpenCommand=e=>t(e)}onOpenCommand(t){this.fileTarget=t,this.doOnOpenCommand(t)}setOnSaveCommand(t){this.doOnSaveCommand=(e,i)=>t(e,i)}onSaveCommand(t){const e=this.texts[t].value||"";this.fileTarget=t;const i=this.nameTexts[t].textContent||"";this.doOnSaveCommand(e,i)}NotifyPftOpened(t,e){this.nameTexts[this.fileTarget].textContent=e.name,this.paths[this.fileTarget]="",this.encodings[this.fileTarget]="UTF-8";var i=this.texts[this.fileTarget];this.fileTarget=-1,i.value=t,i.blur(),i.setSelectionRange(0,0),i.focus()}NotifyPftSaved(t){this.nameTexts[this.fileTarget].textContent=t,this.fileTarget=-1}setEventListeners(){this.buttonNextComment.addEventListener("click",(t=>{this.doOnGoNextComment(this.getCurrentPane())})),this.buttonPreviousComment.addEventListener("click",(t=>{this.doOnGoPreviousComment(this.getCurrentPane())})),this.buttonNextPft.addEventListener("click",(t=>{this.doOnGoNextPft(this.getCurrentPane())})),this.buttonPreviousPft.addEventListener("click",(t=>{this.doOnGoPreviousPft(this.getCurrentPane())})),this.buttonOpenFile.addEventListener("click",(t=>{this.onOpenCommand(this.lastUsed)})),this.buttonSaveFile.addEventListener("click",(t=>{this.onSaveCommand(this.lastUsed)}))}getCurrentPane(){return this.texts[this.lastUsed]}getCurrentLine(t){return this.splitText(t).v2[0]}insertText(t,e){const i=t.selectionStart,n=t.value.substr(0,i),o=t.value.substr(i),s=i+e.length;t.value=n+e+o,t.blur(),t.setSelectionRange(s,s),t.focus()}parenthesize(t){const e=t.selectionStart,i=this.splitText(t),o=i.v2.length>0?i.v2[0]:"",s=n.AppConfig.data.getParentheses1()+o+n.AppConfig.data.getParentheses2(),a=i.v2.length>1?i.v2.slice(1):[],r=e+n.AppConfig.data.input_parentheses_1.length;t.value=i.v1.join("\n")+"\n"+s+"\n"+a.join("\n"),t.blur(),t.setSelectionRange(r,r),t.focus()}parenthesizeShift(t){const e=t.selectionStart,i=this.splitText(t),o=i.v2.length>0?i.v2[0]:"",s=n.AppConfig.data.getParenthesesShift1()+o+n.AppConfig.data.getParenthesesShift2(),a=i.v2.length>1?i.v2.slice(1):[],r=e+n.AppConfig.data.input_parentheses_1.length;t.value=i.v1.join("\n")+"\n"+s+"\n"+a.join("\n"),t.blur(),t.setSelectionRange(r,r),t.focus()}toggleComment(t){const e=t.selectionStart,i=this.splitText(t),n=i.v2.length>0?i.v2[0]:"",s=o.Util.arraySum(i.v1,(t=>t.length));var a="",r=e;if(n.startsWith(this.COMMENT_IPTALK_ID)){const t=this.COMMENT_IPTALK_ID.length;n.length>t&&(a=n.substring(t),r=Math.max(e-t,s))}else if(n.startsWith(this.COMMENT_IDENTIFIER)){const t=this.COMMENT_IDENTIFIER.length;n.length>t&&(a=n.substring(t),r=Math.max(e-t,s))}else{const t=this.COMMENT_IDENTIFIER.length;a=this.COMMENT_IDENTIFIER+n,r=e+t}const l=i.v2.length>1?i.v2.slice(1):[];var h=i.v1.join("\n");h.length>0&&(h+="\n"),t.value=h+a+"\n"+l.join("\n"),t.blur(),t.setSelectionRange(r,r),t.focus()}insertGrossDelimiter(t){const e=t.selectionStart,i=this.splitText(t),n=e+this.GROSS_DELIMITER.length;var o=i.v1.join("\n");o.length>0&&(o+="\n"),t.value=o+this.GROSS_DELIMITER+i.v2.join("\n"),t.blur(),t.setSelectionRange(n,n),t.focus()}getMonitorLines(t){const e=this.splitText(t);return{v1:e.v1.length>=4?e.v1.slice(-4):e.v1,v2:e.v2.length>=10?e.v2.slice(0,10):e.v2}}goNextLine(t){const e=t.selectionStart,i=t.value.indexOf("\n",e);i>=0&&(t.blur(),t.setSelectionRange(i+1,i+1),t.focus())}getGrossLinesAndGoNext(t){const e=this.splitText(t),i=e.v2.length<=this.MAX_LINES_GROSS?e.v2:e.v2.slice(0,this.MAX_LINES_GROSS),n=i.findIndex((t=>"`@"===t));if(n<0)return[];const o=i.slice(0,n);var s=0;e.v1.forEach((t=>{s+=t.length+1}));var a=0;o.forEach((t=>{a+=t.length+1}));const r=s+a+"`@\n".length;return t.blur(),t.setSelectionRange(r,r),t.focus(),o}jumpToPreviousComment(t){var e=0;const i=t.value.lastIndexOf("\n",t.selectionStart-1);if(i>0){const n=t.value.lastIndexOf("\n<-",i-1);n>=0&&(e=n+1)}t.blur(),t.setSelectionRange(e,e),t.focus()}jumpToNextComment(t){const e=t.value.indexOf("\n<-",t.selectionStart);var i=e+1;if(e<0){const e=this.splitText(t);i=t.value.length-e.v2[e.v2.length-1].length}t.blur(),t.setSelectionRange(i,i),t.focus()}goNextPft(t){const e=this.textIdsVjs.indexOf(t.id);return 0<=e&&e<this.textIdsVjs.length-1&&(this.lastUsed++,this.updateAllPftSizes()),this.getCurrentPane().focus(),this.lastUsed}goPreviousPft(t){const e=this.textIdsVjs.indexOf(t.id);return 1<=e&&e<this.textIdsVjs.length&&(this.lastUsed--,this.updateAllPftSizes()),this.getCurrentPane().focus(),this.lastUsed}doOnGoNextComment(t){this.jumpToNextComment(t);const e=this.getMonitorLines(t);this.onChange(e.v1,e.v2)}doOnGoPreviousComment(t){this.jumpToPreviousComment(t);const e=this.getMonitorLines(t);this.onChange(e.v1,e.v2)}doOnGoNextPft(t){const e=this.goNextPft(t);if(e>=0){const t=this.getMonitorLines(this.texts[e]);this.onChange(t.v1,t.v2)}}doOnGoPreviousPft(t){const e=this.goPreviousPft(t);if(e>=0){const t=this.getMonitorLines(this.texts[e]);this.onChange(t.v1,t.v2)}}updatePftSize(t,e){if(!0===n.AppConfig.data.pft_show_isAll){const i=n.AppConfig.data.pft_show_active_ratio,o=Math.floor(100*i/(i-100+100*this.texts.length)),s=Math.floor(1e4/(i-100+100*this.texts.length));t.style.visibility="visible",e===this.lastUsed?(t.style.flexBasis=o+"%",t.style.flexGrow=String(i/100),t.style.flexShrink=String(i/100)):(t.style.flexBasis=s+"%",t.style.flexGrow="1",t.style.flexShrink="1")}else e===this.lastUsed?(t.style.visibility="visible",t.style.flexBasis="100%",t.style.flexGrow="1",t.style.flexShrink="1"):(t.style.visibility="hidden",t.style.flexBasis="0%",t.style.flexGrow="0",t.style.flexShrink="0")}updateAllPftSizes(){for(var t=0;t<this.texts.length;t++)this.updatePftSize(this.panes[t],t)}applyFont(t){t.style.fontFamily=a.UtilDom.makeFontFamily(n.AppConfig.data.pft_font_familyName),t.style.fontSize=n.AppConfig.data.pft_font_size+"pt",t.style.fontWeight=n.AppConfig.data.pft_font_isBold?"bold":"normal"}applyColor(t){t.style.color=n.AppConfig.data.pft_foreColor,t.style.backgroundColor=n.AppConfig.data.pft_backColor}applyNameColor(t,e){t.style.color=n.AppConfig.data.pft_foreColor,t.style.backgroundColor=e===this.lastUsed?n.AppConfig.data.pft_nameBackColor:n.AppConfig.data.pft_nameOtherBackColor}applyAllStyles(){for(var t=0;t<this.texts.length;t++)this.applyFont(this.texts[t]),this.applyColor(this.texts[t]),this.applyFont(this.names[t]),this.applyNameColor(this.names[t],t),this.applyFont(this.nameTexts[t])}configToScreen(){n.AppConfig.data.limitPftShowActiveRatio(),this.applyAllStyles(),this.updateAllPftSizes()}splitText(t){const e=t.selectionStart,i=t.value.substr(0,e).split("\n"),n=i.length>0?i.slice(0,i.length-1):[],o=e-i[i.length-1].length;return{v1:n,v2:t.value.substr(o).split("\n")}}updateConfig(){this.configToScreen()}localize(){this.setTitle(s.T.t("PFT (Pre-Formatted Text)","PFT")+o.Util.getShortcutParenthesized("P"))}setTitle(t){this.titlebar.textContent=t}focus(){0<=this.lastUsed&&this.lastUsed<this.texts.length?this.texts[this.lastUsed].focus():this.texts[0].focus()}toggle(){a.UtilDom.isDisplayed(this.pane)?this.hide():this.show()}show(){a.UtilDom.displayOn(this.pane,"flex")}hide(){a.UtilDom.displayOff(this.pane)}}},323:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PanePftMon=void 0;const n=i(43),o=i(165),s=i(359);e.PanePftMon=class{constructor(){this.pane=document.getElementById("pftMon"),this.titlebar=document.getElementById("pftMon-title"),this.logAbove=document.getElementById("pftMon-above"),this.logText=document.getElementById("pftMon-log-text"),this.logState=document.getElementById("pftMon-state"),this.logStateText=document.getElementById("pftMon-state-text"),this.container=document.getElementById("pftMon-log"),this.isOnShow=!1,this.aboveText="",this.belowText="",this.localize();const t=this.pane.parentElement;null!=t&&t.addEventListener("keydown",(t=>{this.selectAllWhenCtrlA(t)})),this.configToScreen()}getName(){return"PanePftMon"}selectAllWhenCtrlA(t){t.keyCode===s.UtilDom.KEY_A&&s.UtilDom.isCommandOrControlPressed(t)&&(this.logText.focus(),this.logText.select(),t.preventDefault(),t.stopImmediatePropagation())}update(t,e,i){this.updateAbove(t),this.updateBoth(t,e),this.updateState(i.senderName)}updateAbove(t){const e=t.endsWith("\n")?t+" ":t;this.logAbove.textContent=e}updateBoth(t,e){t.length>0?this.logText.textContent=t+"\n"+e:this.logText.textContent=e}updateState(t){this.logStateText.textContent=t?t+o.T.t("'s Pre-Formatted Text","PftMon"):o.T.t("'s Pre-Formatted Text","PftMon")}applyStyle(t){t.style.fontFamily=s.UtilDom.makeFontFamily(n.AppConfig.data.pftMon_font_familyName),t.style.fontSize=n.AppConfig.data.pftMon_font_size+"pt",t.style.fontWeight=n.AppConfig.data.pftMon_font_isBold?"bold":"normal",t.style.color=n.AppConfig.data.pftMon_foreColor,t.style.backgroundColor=n.AppConfig.data.pftMon_backColor}applyFont(t){t.style.fontFamily=s.UtilDom.makeFontFamily(n.AppConfig.data.pftMon_font_familyName),t.style.fontSize=n.AppConfig.data.pftMon_font_size+"pt",t.style.fontWeight=n.AppConfig.data.pftMon_font_isBold?"bold":"normal"}configToScreen(){this.applyFont(this.logAbove),this.applyStyle(this.logText),this.applyStyle(this.container),this.applyStyle(this.logState),this.applyStyle(this.logStateText)}updateConfig(){this.configToScreen()}localize(){this.setTitle(o.T.t("PFT Monitor","PftMon"))}setTitle(t){this.titlebar.textContent=t}setPaneToConfig(){}focus(){this.logText.focus()}toggle(){s.UtilDom.isDisplayed(this.pane)?this.hide():this.show()}show(){s.UtilDom.displayOn(this.pane,"flex")}hide(){s.UtilDom.displayOff(this.pane)}}},165:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.T=void 0;const n=i(882);class o{constructor(){this._locale="",this._failed=[],this._dicts={},this._dict=null,this.initDict()}static data(){return null===o._instance&&(o._instance=new o),o._instance}static t(t,e){const i=o.data().getPhrase(t,e);return""===i?t:(n.Util.isMac()&&i.replace("Ctrl+","Cmd+"),i)}static a(t,e){return o.data().analyze(t,e)}static matchLocale(t){return o.data()._matchLocale(t)}static getBrowserLocale(){return window.navigator.languages&&window.navigator.languages[0]||window.navigator.language}static setLocale(t){return o.data().setInnerLocale(t),!0}static getLocales(){var t=["en"];for(var e of Object.keys(o.data()._dicts))t.push(e);t.sort();var i=[];for(var e of t){if("en"===e){i.push({v1:"en",v2:"English"});continue}const t=o.data()._dicts[e];if(void 0===t)continue;const n=t.MyName;if(void 0===n)continue;const s=n.English;void 0!==s&&i.push({v1:e,v2:s})}return i}static getFails(){return o.data().getAllFails()}_matchLocale(t){if("en"===t||"en-US"===t)return"";if(void 0!==this._dicts[t])return t;const e=t.indexOf("-");if(e<=0)return"";const i=t.substr(0,e);return void 0!==this._dicts[i]?i:""}setInnerLocale(t){this._locale=this._matchLocale(t),""===this._locale?this._dict=null:this._dict=this._dicts[this._locale]}trySetLocale(t){if("en"===t||"en-US"===t)return this._locale="",this._dict=null,!0;const e=this._dicts[t];if(null!=e)return this._locale=t,this._dict=e,!0;const i=t.indexOf("-");if(i<=0)return!1;const n=t.substr(0,i),o=this._dicts[n];return null!=o&&(this._locale=n,this._dict=o,!0)}analyze(t,e){if(null===this._dict)return`dict===null. return [${t}]`;const i=this._dict[e];if(void 0===i)return`dict[${e}] is undef.`;const n=i[t];return void 0===n?`phrases[${t}] is undef.`:`found [${n}]`}getPhrase(t,e){if(null===this._dict)return t;const i=this._dict[e];if(void 0===i)return this._failed.push({v1:t,v2:e}),t;const n=i[t];return void 0===n?(this._failed.push({v1:t,v2:e}),t):n}getAllFails(){return this._failed}initDict(){this._dicts.ja={MyName:{English:"日本語"},General:{"mekiku-web":"web版mekiku",OK:"OK",Cancel:"キャンセル",Error:"エラー",Warning:"警告","all files":"全てのファイル","file name":"ファイル名",Subtitler:"入力者",Viewer:"閲覧者","Number of Viewers":"閲覧者数","Error occured on file access.\nIf another application is using it, first quit it.":"ファイルへのアクセスでエラーが発生しました。\n他のプログラムでファイルを開いていたら、そちらを終了してください。","Communication error.":"通信エラーです。","System error.":"システムエラーです。",Detail:"詳細","Internet Explorer and old version of Microsoft Edge are not supported.":"Internet Explorerおよび旧版のMicrosoft Edgeでは利用できません。"},Input:{"Input Window":"入力ウインドウ"},Chat:{Chat:"連絡窓",Start:"カウントダウン開始",Halt:"カウントダウン停止",Reset:"残り時刻リセット","Increase Timer By A Minute":"タイマー1分延長","Decrease Timer By A Minute":"タイマー1分短縮","0:00":"0：00","30 seconds to next turn.":"30秒前です。"," : ":"／","It's new turn now.":"交代です。","Timer started. Next ":"タイマーを開始しました。通知間隔 ","Timer halted.":"タイマーを停止しました。",login:"新規ログイン","New viewer":"閲覧者がログイン",logout:"ログアウト","A viewer left":"閲覧者が退室",memo:"メモ","Zoom captioning has been set.":"Zoom字幕出力が設定されました。","Zoom captioning has been cleared.":"Zoom字幕出力は、解除されました。","Failed sending captions.":"字幕送信が失敗しています。"},Monitor:{"Input Monitor":"入力モニター",name:"名前","current input window":"入力中の内容",connect:"接続"},PFT:{"PFT (Pre-Formatted Text)":"前ロール","Open (Ctrl+O)":"開く (Ctrl+O)","Save As (Ctrl+S)":"名前をつけて保存 (Ctrl+S)","Next Comment (Ctrl+down)":"次のコメント行へジャンプ (Ctrl+↓)","Previous Comment (Ctrl+up)":"前のコメント行へジャンプ (Ctrl+↑)","Next Window (Ctrl+right)":"次のウインドウへ移動 (Ctrl+→)","Previous Window (Ctrl+left)":"前のウインドウへ移動 (Ctrl+←)","PFT files":"前ロールファイル","UTF-8 PFT files":"UTF-8前ロールファイル","Unicode PFT files":"Unicode前ロールファイル","text files":"テキストファイル"},PftMon:{"PFT Monitor":"前ロールモニター","'s Pre-Formatted Text":"の前ロールをモニター中"},Fkey:{Shortcut:"Fキー","Parenthesize all":"行全体をかっこでくくる",Undo:"入力部へ1回分引く(undo)","(Not available)":"（使用不能）"},Log:{Log:"ログ"},Login:{Login:"ログイン","LAN card":"LANカード",Name:"名前",Channel:"チャンネル",Group:"班","The network port is occupied by other application.\nSelect another channel and login.":"同じネットワークポートが別のプログラムに使われています。\n別チャンネルを指定して再ログインしてみてください。","Network error occurs. Make sure network connection.":"ネットワークエラーです。接続を再確認してください。","(No Network Available)":"（接続可能なLANがありません）",Room:"ルーム",Viewer:"利用者・閲覧者",Subtitler:"入力者（要約筆記者）",Password:"パスワード","Login failed.":"ログインに失敗しました。","No Room.":"ルームが存在しません。"},Config:{Config:"設定"},"Config|General":{"Font Size":"文字の大きさ","Font Name":"フォント名","Font Color":"文字色",Bold:"太字","Background Color":"背景色",Show:"表示する"},"Config|Misc":{General:"全体的な設定","Re-Login":"LANカードを選んで（再）接続","Full Screen":"全画面化","Select Language":"言語の選択","To make your choice effective, Restart mekiku-M.":"言語選択を有効にするには、mekiku-Mを再起動してください。","Save main log":"表示部のログを保存する","Save chat log":"連絡窓のログを保存する","Startup Settings":"起動時設定","Keep Last Settings":"前回終了時の設定を初期設定にする","Zoom API key":"Zoom APIキー"},"Config|Main":{"Main Display":"メイン表示部","Display style":"表示形式",Normal:"通常表示","Full Width":"幅を最大化","Full Window":"ウインドウ内最大化","Line Height":"1行の高さ","Scroll interval per line":"1行のスクロール間隔",msec:"ミリ秒"},"Config|Input":{"Parentheses on F8 press":"F8押下時に囲む文字","Parentheses on Shift+F8 press":"Shift+F8押下時に囲む文字","“":"「","”":"」","(":"（",")":"）"},"Config|Chat":{"Notification Color":"通知時の背景色","Play sound on timer-notifications":"タイマー通知で音を出す"},"Config|Monitor":{"Background Color On Loss":"通信断の際の背景色"},"Config|PFT":{"Background Color (Name)":"前ロール名の背景色","Background Color (Name of Other Panes)":"非選択前ロール名の背景色","Display All":"全ウインドウを表示","Current Window Width":"選択中のウインドウ幅","Same As Others (x1.0)":"他と同じ（1.0倍）","50% wider (x1.5)":"他の5割増（1.5倍）","double (x2.0)":"他の2倍（2.0倍）","triple (x3.0)":"他の3倍（3.0倍）"},"Menu|Menu":{Menu:"メニュー",File:"ファイル",Edit:"編集","Re-Login":"LANカードを選んで（再）接続","Open Settings...":"設定ファイルを開く...","Save Settings As...":"設定に名前をつけて保存...","Config...":"設定...","Reset All Settings":"設定を初期化","Current As Default":"現在の設定を初期設定にする","Full Screen":"全画面化","Version...":"バージョン...",Exit:"終了","mekiku-M settings files":"mekiku-M設定ファイル",Undo:"元に戻す",Cut:"切り取り",Copy:"コピー",Paste:"貼り付け","Select All":"すべて選択"}},this._dicts.th={MyName:{English:"ภาษาไทย"},General:{OK:"OK",Cancel:"ยกเลิก",Error:"ข้อผิดพลาด",Warning:"เตือน","all files":"ไฟล์ทั้งหมด","Error occured on file access.\nIf another application is using it, first quit it.":"เกิดข้อผิดพลาดในการอ่านไฟล์\nถ้าแอพพลิเคชั่นอื่นกำลังใช้ไฟล์นี้\nให้ปิดไฟล์นี้ก่อน"},Input:{"Input Window":"หน้าต่างอินพุท"},Chat:{Chat:"แช็ท",Start:"เริ่ม",Halt:"หยุด",Reset:"ตั้งใหม่","Increase Timer By A Minute":"เพิ่มเวลาเป็น A นาที","Decrease Timer By A Minute":"ลดเวลาเป็น A นาที","0:00":"0:00","30 seconds to next turn.":"อีกสามสิบวิ.จะเริ่มใหม่"," : ":" : ","It's new turn now.":"เริ่มใหม่","Timer started. Next ":"ไทเมอร์เริ่ม ถัดไป ","Timer halted.":"ไทเมอร์หยุด "},Monitor:{"Input Monitor":"มอนิเตอร์อินพุท",name:"ชื่อ","current input window":"หน้าต่างที่กำลังอินพุท",connect:"เชื่อมต่อ"},PFT:{"PFT (Pre-Formatted Text)":"พรีฟอร์แม็ทเท็กซ์","Open... (Ctrl+O)":"เปิด... (Ctrl+O)","Save As (Ctrl+S)":"บันทึกเป็น... (Ctrl+S)","Next Comment (Ctrl+down)":"คอมเมนต์ถัดไป (Ctrl+down)","Previous Comment (Ctrl+up)":"คอมเมนต์ก่อนหน้า (Ctrl+up)","Next Window (Ctrl+right)":"หน้าต่างถัดไป (Ctrl+right)","Previous Window (Ctrl+left)":"หน้าต่างก่อนหน้า (Ctrl+left)","PFT files":"พีเอฟทีไฟล์ ","UTF-8 PFT files":"UTF-8 พีเอฟทีไฟล์ ","Unicode PFT files":"ยูนิโค้ด พีเอฟทีไฟล์ ","text files":"เท็กซ์ไฟล์"},PftMon:{"PFT Monitor":"มอนิเตอร์พีเอฟที","'s Pre-Formatted Text":"พรีฟอร์แม็ทเท็กซ์"},Fkey:{Shortcut:"ปุ่มลัด","Parenthesize all":"วงเล็บทั้งหมด ",Undo:"กลับที่เดิม","(Not available)":"(ไม่สามารถใช้ได้)"},Log:{Log:"ล็อก"},Login:{Login:"ล็อกอิน ","LAN card":"แลนการ์ด",Name:"ชื่อ",Channel:"ช่องทาง",Group:"กลุ่ม","The network port is occupied by other application.\nSelect another channel and login.":"เน็ทเวิร์คพอร์ต\nมีแอพพลิเคชั่นอื่นใช้อยู่\nเลือกช่องทางอื่นแล้ว\nล็อกอิน","Network error occurs. Make sure network connection.":"เกิดข้อผิดพลาดจากเน็ทเวิร์ค \nตรวจสอบการเชื่อมต่อ\nเน็ทเวิร์ค","(No Network Available)":"(ไม่มีเน็ทเวิร์ค)"},Config:{Config:"การตั้งค่า "},"Config|General":{"Font Size":"ขนาดฟอนต์","Font Name":"ฟ้อนต์","Font Color":"สีฟ้อนต์",Bold:"ตัวหนา","Background Color":"สีพื้นหลัง",Show:"แสดง"},"Config|Misc":{General:"การติดตั้งทั้งหมด","Re-Login":"ล็อกอินใหม่","Full Screen":"เต็มจอภาพ","Select Language":"เลือกภาษา","To make your choice effective, Restart mekiku-M.":"เพื่อให้ได้งานตามที่คุณ เลือก, เริ่มเปิด mekiku-M อีกครั้ง","Save main log":"บันทึก (ล็อกหน้าต่างหลัก)","Save chat log":"บันทึก (ล็อกหน้าต่างแช็ท)","Startup Settings":"ตั้งค่าเริ่มต้น","Keep Last Settings":"ตั้งเป็นค่าล่าสุด"},"Config|Main":{"Main Display":"จอแสดงผลหลัก","Display style":"การแสดงรูปแบบ",Normal:"ปกติ","Full Width":"ความกว้างเต็มจอ","Full Window":"เต็มหน้าต่าง","Line Height":"ความสูงบรรทัด","Scroll interval per line":"ระยะห่างของสกรอล ต่อบรรทัด",msec:"มิลลิเซ็คเคิ่น"},"Config|Input":{"Parentheses on F8 press":"ใส่วงเล็บโดยกด F8","Parentheses on Shift+F8 press":"Shift+F8","“":'""',"”":'""',"(":"(",")":")"},"Config|Chat":{"Notification Color":"สีเตือน"},"Config|Monitor":{"Background Color On Loss":"สีพื้นหลัง  เปิดและตัด"},"Config|PFT":{"Background Color (Name)":"สีพื้นหลัง(ชื่อไฟล์)","Background Color (Name of Other Panes)":"สีพื้นหลัง(ชื่อไฟล์อื่น)","Display All":"ดิสเพลย์ทั้งหมด","Current Window Width":"ความกว้างหน้าต่างปัจจุบัน","Same As Others (x1.0)":"เหมือนอื่นๆ","50% wider (x1.5)":"กว้างขึ้น 1.5 เท่า","double (x2.0)":"2 เท่า","triple (x3.0)":"3 เท่า"},"Menu|Menu":{Menu:"เมนู",File:"ไฟล์",Edit:"การแก้ไข","Re-Login":"ล็อกอินใหม่","Open Settings...":"เปิดไฟล์ตั้งค่าที่เซฟไว้ ...","Save Settings As...":"บันทึกค่าที่ตั้งไว้เป็น ...","Config...":"การตั้งค่า ...","Reset All Settings":"ตั้งค่าใหม่หมด","Current As Default":"ตั้งค่าปัจจุบันเป็นค่าเริ่มต้น","Full Screen":"เต็มจอภาพ","Version...":"เวอร์ชั่น ...",Exit:"ออก","mekiku-M settings files":"ไฟล์ตั้งค่า mekiku-M",Undo:"เลิกทำ",Cut:"ตัด",Copy:"คัดลอก",Paste:"วาง","Select All":"เลือกทั้งหมด"}}}}e.T=o,o._instance=null,o._isMac=!1},882:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Util=void 0;class i{static beforeOf(t,e){const i=t.indexOf(e);return i<0?t:t.substring(0,i)}static isRoomNameLegit(t){return/^[A-Za-z0-9]+$/.test(t)}static extractPossibleRoomName(t){const e=i.queryString2kvArray(t),n=e[e.length-1];return""!==n.key&&""===n.value?n.key:""}static queryString2kvArray(t){const e=Array();return t.split("&").map((t=>{const i=t.split("="),n=i[0],o=i.length>1?i[1]:"";e.push({key:n,value:o})})),e}static makeQueryStringWithNewRoom(t,e){if(""===e)return t;const i=this.queryString2kvArray(e);if(""!==i[i.length-1].value)return t.length>0?e+"&"+t:e;if(1===i.length)return t;const n=e.lastIndexOf("&"),o=e.substring(0,n);return t.length>0?o+"&"+t:o}static contains(t,...e){for(const i in e)if(t.indexOf(e[i])>=0)return!0;return!1}static isString(t){return"string"==typeof t||t instanceof String}static isNumber(t){return"number"==typeof t&&isFinite(t)}static toNumber(t,e=0){if(this.isNumber(t))return t;if(this.isString(t)){const e=parseInt(t,10);if(!1===Number.isNaN(e))return e}return e}static getNowUTCTimeString(){const t=new Date;return`${t.getUTCHours().toString().padStart(2,"0")}:${t.getUTCMinutes().toString().padStart(2,"0")}:${t.getUTCSeconds().toString().padStart(2,"0")}.${t.getUTCMilliseconds().toString().padStart(3,"0")}`}static arraySum(t,e){var i=0;return t.forEach(((t,n,o)=>{i+=e(t,n,o)})),i}static toLf(t){return t.replace(/\r\n?/g,"\n")}static toCrLf(t){return this.toLf(t).replace(/\n/g,"\r\n")}static toStringWithZero(t,e){return("0".repeat(e)+t.toFixed(0)).slice(-e)}static getNewLineCode(){return this.isWin()?"\r\n":"\n"}static isWin(){return!!window.navigator.platform.toLowerCase().includes("win")}static isMac(){const t=window.navigator.platform.toLowerCase();return!!(t.includes("mac")||t.includes("iphone")||t.includes("ipad"))}static getShortcutTextRaw(t){return t.length<1?"":(this.isMac()?"Cmd+":"Ctrl+")+t.charAt(0)}static getShortcutText(t){return t.length<1?"":" "+this.getShortcutTextRaw(t)}static getShortcutParenthesized(t){return t.length<1?"":" ("+this.getShortcutTextRaw(t)+")"}static getShiftShortcutTextRaw(t){return t.length<1?"":(this.isMac()?"Shift+Cmd+":"Ctrl+Shift+")+t.charAt(0)}static getShiftShortcutText(t){return t.length<1?"":" "+this.getShiftShortcutTextRaw(t)}static getShiftShortcutParenthesized(t){return t.length<1?"":" ("+this.getShiftShortcutTextRaw(t)+")"}static numberToText2(t){return t.toString().padStart(2,"0")}static getIsoModifiedDateTimeString(){const t=new Date;return`${t.getFullYear().toString()}-${this.numberToText2(t.getMonth()+1)}-${this.numberToText2(t.getDate())}_${this.numberToText2(t.getHours())}:${this.numberToText2(t.getMinutes())}:${this.numberToText2(t.getSeconds())}`}static getIsoStyleDateString(){const t=new Date;return`${t.getFullYear().toString()}-${this.numberToText2(t.getMonth()+1)}-${this.numberToText2(t.getDate())}`}static async digestMessage(t){const e=(new TextEncoder).encode(t),i=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(i)).map((t=>t.toString(16).padStart(2,"0"))).join("")}constructor(){}}e.Util=i},359:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UtilDom=void 0;const n=i(882);class o{constructor(){}static getQuery(){const t=location.search;return t.length>0&&"?"===t[0]?t.substring(1):""}static setQuery(t){history.replaceState({},"","?"+t)}static getWidth(t){return t?t.getBoundingClientRect().width:-1}static show(t){null!=t&&(t.style.visibility="visible")}static hide(t){null!=t&&(t.style.visibility="hidden")}static isShown(t){return null!=t&&"visible"===t.style.visibility}static displayOn(t,e="initial"){null!=t&&(t.style.display=e)}static displayOff(t){null!=t&&(t.style.display="none")}static isDisplayed(t){return null!=t&&"none"!==t.style.display}static makeDialogsRespondToKey(){for(const t of document.querySelectorAll("div.dialog")){if(t.classList.contains("ignore_return"))continue;const e=t.querySelector("button.submit"),i=null!=e?e:void 0,n=t.querySelector("button.cancel"),s=null!=n?n:void 0;for(const e of t.querySelectorAll('input[type="text"]'))e.addEventListener("keydown",(t=>{t.keyCode===o.KEY_ENTER&&(null==i||i.click()),t.keyCode===o.KEY_ESC&&(null==s||s.click())}));for(const e of t.querySelectorAll('input[type="password"]'))e.addEventListener("keydown",(t=>{t.keyCode===o.KEY_ENTER&&(null==i||i.click()),t.keyCode===o.KEY_ESC&&(null==s||s.click())}))}}static getFKeyNumber(t){if(t.length<2||t.length>3)return-1;if("F"!==t.charAt(0))return-1;const e=Number(t.substr(1));return Number.isInteger(e)&&e>0?e:-1}static getFKeyNumberByKeyCode(t){return t<112||t>123?-1:t-111}static getCtrlOrFKeyNumber(t){const e=this.getFKeyNumberByKeyCode(t.keyCode);return e>=0?e:t.key>="0"&&t.key<="9"&&this.isCommandOrControlPressed(t)?parseInt(t.key):/^Digit[0-9]$/.test(t.code)&&this.isCommandOrControlPressed(t)?parseInt(t.code.substr(5)):-1}static isCommandOrControlPressed(t){return navigator.platform,n.Util.isMac()?t.metaKey:t.ctrlKey}static parseFloatEx(t,e=0){return null!==t?parseFloat(t):e}static makeFontFamily(t,e="sans-serif"){return null===t||t.trim().length<1?e:t.trim()===e?t:t+" , "+e}static addSelectOption(t,e,i){const n=document.createElement("option");n.text=e,n.value=i,t.add(n)}static extractCSSRulesByText(t){return this.extractCSSRules((e=>e.cssText.indexOf(t)>=0))}static extractCSSRules(t){var e=[];for(const i of document.styleSheets)for(const n of i.cssRules)t(n)&&e.push(n);return e}static getModifierKey(t){return(t.shiftKey?this.MK_SHIFT:0)+(t.ctrlKey?this.MK_CTRL:0)+(t.altKey?this.MK_ALT:0)+(t.metaKey?this.MK_META:0)}static getLuminance(t){const e=/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/.exec(t);if(null===e)return-1;if(e[3]){const t=parseInt(e[1],16),i=parseInt(e[2],16),n=parseInt(e[3],16);return(Math.max(t,i,n)+Math.min(t,i,n))/2}return-1}}e.UtilDom=o,o.MK_SHIFT=1,o.MK_CTRL=2,o.MK_ALT=4,o.MK_META=8,o.KEY_TAB=9,o.KEY_ENTER=13,o.KEY_CTRL=17,o.KEY_ESC=27,o.KEY_ARROW_LEFT=37,o.KEY_ARROW_UP=38,o.KEY_ARROW_RIGHT=39,o.KEY_ARROW_DOWN=40,o.KEY_A=65,o.KEY_B=66,o.KEY_C=67,o.KEY_D=68,o.KEY_E=69,o.KEY_F=70,o.KEY_G=71,o.KEY_H=72,o.KEY_I=73,o.KEY_J=74,o.KEY_K=75,o.KEY_L=76,o.KEY_M=77,o.KEY_N=78,o.KEY_O=79,o.KEY_P=80,o.KEY_Q=81,o.KEY_R=82,o.KEY_S=83,o.KEY_T=84,o.KEY_U=85,o.KEY_V=86,o.KEY_W=87,o.KEY_X=88,o.KEY_Y=89,o.KEY_Z=90}},e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i(607)})();